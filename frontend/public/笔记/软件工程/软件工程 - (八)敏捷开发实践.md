# 软件工程 - (八)敏捷开发实践

理解敏捷开发方法。

---

## 8. 敏捷开发实践

### 8.1 Scrum框架详解

```python
from datetime import datetime, timedelta

class UserStory:
    """用户故事"""
    def __init__(self, title, description, points, priority=1):
        self.title = title
        self.description = description
        self.points = points
        self.priority = priority
        self.status = 'TODO'  # TODO, IN_PROGRESS, DONE
    
    def __repr__(self):
        return f"[{self.status}] {self.title} ({self.points}点)"

class Sprint:
    """Sprint冲刺"""
    def __init__(self, name, start_date, duration_days=14):
        self.name = name
        self.start_date = start_date
        self.end_date = start_date + timedelta(days=duration_days)
        self.stories = []
        self.capacity = 0
    
    def add_story(self, story):
        """添加故事到Sprint"""
        if sum(s.points for s in self.stories) + story.points <= self.capacity:
            self.stories.append(story)
            return True
        return False
    
    def burndown_chart(self):
        """燃尽图数据"""
        total_points = sum(s.points for s in self.stories)
        completed_points = sum(s.points for s in self.stories if s.status == 'DONE')
        remaining_points = total_points - completed_points
        
        return {
            '总点数': total_points,
            '已完成': completed_points,
            '剩余': remaining_points,
            '完成率': f"{completed_points/total_points*100:.1f}%" if total_points > 0 else "0%"
        }

class ScrumTeam:
    """Scrum团队"""
    def __init__(self, name):
        self.name = name
        self.product_backlog = []
        self.current_sprint = None
        self.velocity = []  # 速率历史
    
    def add_user_story(self, story):
        """添加用户故事到Product Backlog"""
        self.product_backlog.append(story)
        # 按优先级排序
        self.product_backlog.sort(key=lambda x: x.priority, reverse=True)
    
    def plan_sprint(self, sprint_name, capacity):
        """Sprint计划会议"""
        self.current_sprint = Sprint(sprint_name, datetime.now())
        self.current_sprint.capacity = capacity
        
        print(f"\n=== {sprint_name} 计划会议 ===")
        print(f"团队容量: {capacity}点")
        
        selected = []
        for story in self.product_backlog:
            if self.current_sprint.add_story(story):
                selected.append(story)
                print(f"✅ 选入: {story}")
            else:
                break
        
        # 从Backlog移除已选入的故事
        for story in selected:
            self.product_backlog.remove(story)
        
        return self.current_sprint
    
    def daily_standup(self):
        """每日站会"""
        print(f"\n=== 每日站会 ===")
        for story in self.current_sprint.stories:
            print(f"{story}")
    
    def sprint_review(self):
        """Sprint评审"""
        print(f"\n=== Sprint评审 ===")
        completed = sum(1 for s in self.current_sprint.stories if s.status == 'DONE')
        total = len(self.current_sprint.stories)
        velocity = sum(s.points for s in self.current_sprint.stories if s.status == 'DONE')
        
        self.velocity.append(velocity)
        
        print(f"完成故事: {completed}/{total}")
        print(f"本Sprint速率: {velocity}点")
        print(f"平均速率: {sum(self.velocity)/len(self.velocity):.1f}点")
        print(f"燃尽图: {self.current_sprint.burndown_chart()}")

# 示例使用
team = ScrumTeam("开发团队A")

# 添加用户故事
team.add_user_story(UserStory("用户登录", "作为用户，我想登录系统", 5, priority=3))
team.add_user_story(UserStory("查看订单", "作为用户，我想查看订单列表", 3, priority=2))
team.add_user_story(UserStory("下单购买", "作为用户，我想下单购买商品", 8, priority=3))

# Sprint计划
sprint = team.plan_sprint("Sprint 1", capacity=10)

# 模拟开发
sprint.stories[0].status = 'DONE'
sprint.stories[1].status = 'IN_PROGRESS'

# 每日站会
team.daily_standup()

# Sprint评审
team.sprint_review()
```

### 8.2 看板（Kanban）

```python
class KanbanBoard:
    """看板"""
    def __init__(self):
        self.columns = {
            'TODO': [],
            'IN_PROGRESS': [],
            'CODE_REVIEW': [],
            'TESTING': [],
            'DONE': []
        }
        self.wip_limits = {
            'IN_PROGRESS': 3,
            'CODE_REVIEW': 2,
            'TESTING': 2
        }
    
    def add_task(self, task):
        """添加任务"""
        self.columns['TODO'].append(task)
    
    def move_task(self, task, to_column):
        """移动任务"""
        # 检查WIP限制
        if to_column in self.wip_limits:
            if len(self.columns[to_column]) >= self.wip_limits[to_column]:
                print(f"❌ {to_column} 已达到WIP限制({self.wip_limits[to_column]})")
                return False
        
        # 找到任务并移动
        for col in self.columns.values():
            if task in col:
                col.remove(task)
                break
        
        self.columns[to_column].append(task)
        print(f"✅ {task} → {to_column}")
        return True
    
    def display(self):
        """显示看板"""
        print("\n" + "="*60)
        print("看板状态")
        print("="*60)
        for col, tasks in self.columns.items():
            limit = f" (WIP: {len(tasks)}/{self.wip_limits[col]})" if col in self.wip_limits else ""
            print(f"\n{col}{limit}:")
            for task in tasks:
                print(f"  • {task}")

# 示例
board = KanbanBoard()
board.add_task("实现登录功能")
board.add_task("修复支付bug")
board.add_task("优化性能")

board.move_task("实现登录功能", 'IN_PROGRESS')
board.move_task("修复支付bug", 'IN_PROGRESS')
board.display()
```

---

**本章完**
