# 概率论与数理统计 - (三)多维随机变量

学习多维随机变量及其分布。

---

## 3. 多维随机变量

### 3.1 二维随机变量的概念

#### 定义

**二维随机变量**：$(X, Y)$ 是定义在同一样本空间上的两个随机变量的有序对。

**联合分布函数**：

$$
F(x, y) = P(X \leq x, Y \leq y)
$$

#### 联合分布函数的性质

**性质1**（单调性）：$F(x, y)$ 关于 $x$ 和 $y$ 都单调非减

**性质2**（有界性）：

$$
0 \leq F(x, y) \leq 1
$$

$$
F(-\infty, y) = F(x, -\infty) = 0, \quad F(+\infty, +\infty) = 1
$$

**性质3**（右连续性）：$F(x, y)$ 关于 $x$ 和 $y$ 都右连续

**性质4**（矩形概率）：

$$
P(a < X \leq b, c < Y \leq d) = F(b, d) - F(a, d) - F(b, c) + F(a, c)
$$

### 3.2 二维离散型随机变量

#### 联合概率质量函数

**定义**：$(X, Y)$ 的联合PMF为

$$
p_{ij} = P(X = x_i, Y = y_j)
$$

满足：
1. $p_{ij} \geq 0$
2. $\sum_i \sum_j p_{ij} = 1$

#### 边缘分布

**$X$ 的边缘PMF**：

$$
p_i^{(X)} = P(X = x_i) = \sum_j P(X = x_i, Y = y_j) = \sum_j p_{ij}
$$

**$Y$ 的边缘PMF**：

$$
p_j^{(Y)} = P(Y = y_j) = \sum_i P(X = x_i, Y = y_j) = \sum_i p_{ij}
$$

**例1**：设 $(X, Y)$ 的联合分布列为

| $X \backslash Y$ | 0 | 1 | 2 |
|------------------|---|---|---|
| 0 | 0.1 | 0.2 | 0.1 |
| 1 | 0.1 | 0.3 | 0.2 |

求边缘分布。

**解**：

$X$ 的边缘分布：

$$
\begin{aligned}
P(X = 0) &= 0.1 + 0.2 + 0.1 = 0.4 \\
P(X = 1) &= 0.1 + 0.3 + 0.2 = 0.6
\end{aligned}
$$

$Y$ 的边缘分布：

$$
\begin{aligned}
P(Y = 0) &= 0.1 + 0.1 = 0.2 \\
P(Y = 1) &= 0.2 + 0.3 = 0.5 \\
P(Y = 2) &= 0.1 + 0.2 = 0.3
\end{aligned}
$$

### 3.3 二维连续型随机变量

#### 联合概率密度函数

**定义**：若存在非负函数 $f(x, y)$ 使得

$$
F(x, y) = \int_{-\infty}^{x} \int_{-\infty}^{y} f(u, v) \, dv \, du
$$

则称 $(X, Y)$ 为二维连续型随机变量，$f(x, y)$ 为联合概率密度函数（Joint PDF）。

**性质**：

1. $f(x, y) \geq 0$
2. $\int_{-\infty}^{+\infty} \int_{-\infty}^{+\infty} f(x, y) \, dy \, dx = 1$
3. $P((X, Y) \in D) = \iint_D f(x, y) \, dy \, dx$
4. $f(x, y) = \frac{\partial^2 F(x, y)}{\partial x \partial y}$（在连续点处）

#### 边缘概率密度

**$X$ 的边缘PDF**：

$$
f_X(x) = \int_{-\infty}^{+\infty} f(x, y) \, dy
$$

**$Y$ 的边缘PDF**：

$$
f_Y(y) = \int_{-\infty}^{+\infty} f(x, y) \, dx
$$

**例2**：设 $(X, Y)$ 的联合密度为

$$
f(x, y) = \begin{cases}
2, & 0 \leq x \leq 1, 0 \leq y \leq x \\
0, & \text{其他}
\end{cases}
$$

求边缘密度。

**解**：

**$X$ 的边缘密度**：

$$
f_X(x) = \int_{-\infty}^{+\infty} f(x, y) \, dy = \begin{cases}
\int_0^x 2 \, dy = 2x, & 0 \leq x \leq 1 \\
0, & \text{其他}
\end{cases}
$$

**$Y$ 的边缘密度**：

$$
f_Y(y) = \int_{-\infty}^{+\infty} f(x, y) \, dx = \begin{cases}
\int_y^1 2 \, dx = 2(1-y), & 0 \leq y \leq 1 \\
0, & \text{其他}
\end{cases}
$$

#### 常见二维连续分布

##### 二维均匀分布

$(X, Y) \sim U(D)$（在区域 $D$ 上均匀分布）

$$
f(x, y) = \begin{cases}
\frac{1}{S_D}, & (x, y) \in D \\
0, & \text{其他}
\end{cases}
$$

其中 $S_D$ 为区域 $D$ 的面积。

##### 二维正态分布

$(X, Y) \sim N(\mu_1, \mu_2, \sigma_1^2, \sigma_2^2, \rho)$

$$
f(x, y) = \frac{1}{2\pi\sigma_1\sigma_2\sqrt{1-\rho^2}} \exp\left\{-\frac{1}{2(1-\rho^2)}\left[\frac{(x-\mu_1)^2}{\sigma_1^2} - \frac{2\rho(x-\mu_1)(y-\mu_2)}{\sigma_1\sigma_2} + \frac{(y-\mu_2)^2}{\sigma_2^2}\right]\right\}
$$

**参数**：
- $\mu_1, \mu_2$：均值
- $\sigma_1^2, \sigma_2^2$：方差
- $\rho$：相关系数（$-1 < \rho < 1$）

**性质**：
1. 边缘分布：$X \sim N(\mu_1, \sigma_1^2)$，$Y \sim N(\mu_2, \sigma_2^2)$
2. $\rho = 0$ 时，$X$ 和 $Y$ 独立
3. 线性组合仍为正态分布

### 3.4 条件分布

#### 离散型条件分布

**条件PMF**：

$$
P(X = x_i | Y = y_j) = \frac{P(X = x_i, Y = y_j)}{P(Y = y_j)} = \frac{p_{ij}}{p_j^{(Y)}}
$$

前提：$P(Y = y_j) > 0$

**例3**（接例1）：已知 $Y = 1$，求 $X$ 的条件分布。

**解**：

$$
P(Y = 1) = 0.5
$$

$$
\begin{aligned}
P(X = 0 | Y = 1) &= \frac{P(X = 0, Y = 1)}{P(Y = 1)} = \frac{0.2}{0.5} = 0.4 \\
P(X = 1 | Y = 1) &= \frac{P(X = 1, Y = 1)}{P(Y = 1)} = \frac{0.3}{0.5} = 0.6
\end{aligned}
$$

#### 连续型条件分布

**条件PDF**：

$$
f_{X|Y}(x|y) = \frac{f(x, y)}{f_Y(y)}, \quad f_Y(y) > 0
$$

**条件期望**：

$$
E[X | Y = y] = \int_{-\infty}^{+\infty} x f_{X|Y}(x|y) \, dx
$$

**例4**（接例2）：已知 $Y = y$（$0 < y < 1$），求 $X$ 的条件密度和条件期望。

**解**：

$$
f_{X|Y}(x|y) = \frac{f(x, y)}{f_Y(y)} = \begin{cases}
\frac{2}{2(1-y)} = \frac{1}{1-y}, & y \leq x \leq 1 \\
0, & \text{其他}
\end{cases}
$$

这是 $U[y, 1]$ 均匀分布，所以

$$
E[X | Y = y] = \frac{y + 1}{2}
$$

### 3.5 随机变量的独立性

#### 独立性定义

**定义**：若对所有 $x, y$，

$$
F(x, y) = F_X(x) \cdot F_Y(y)
$$

则称 $X$ 和 $Y$ 相互独立。

**等价条件**：

**离散型**：

$$
P(X = x_i, Y = y_j) = P(X = x_i) \cdot P(Y = y_j), \quad \forall i, j
$$

**连续型**：

$$
f(x, y) = f_X(x) \cdot f_Y(y), \quad \forall x, y
$$

#### 独立性的判断

**方法1**：检验 $f(x, y) = f_X(x) \cdot f_Y(y)$

**方法2**：若 $f(x, y)$ 可分离变量，即

$$
f(x, y) = g(x) h(y)
$$

且积分域为矩形，则 $X$ 和 $Y$ 独立。

**例5**：判断下列 $(X, Y)$ 是否独立：

(1) $f(x, y) = \begin{cases} 6x, & 0 \leq x \leq 1, 0 \leq y \leq x \\ 0, & \text{其他} \end{cases}$

(2) $f(x, y) = \begin{cases} 1, & 0 \leq x \leq 1, 0 \leq y \leq 1 \\ 0, & \text{其他} \end{cases}$

**解**：

(1) 积分域不是矩形（$y \leq x$），所以不独立。

(2) 
$$
f(x, y) = 1 = 1 \cdot 1 = f_X(x) f_Y(y)
$$

其中 $f_X(x) = 1 \ (0 \leq x \leq 1)$，$f_Y(y) = 1 \ (0 \leq y \leq 1)$，且积分域为矩形，所以独立。

#### 独立性的性质

**性质1**：若 $X$ 和 $Y$ 独立，则

$$
E[XY] = E[X] E[Y]
$$

$$
\text{Var}(X + Y) = \text{Var}(X) + \text{Var}(Y)
$$

**性质2**：若 $X$ 和 $Y$ 独立，则 $g(X)$ 和 $h(Y)$ 也独立（$g, h$ 为可测函数）

**注意**：$E[XY] = E[X]E[Y]$ 不能推出独立性！（只能推出不相关）

### 3.6 协方差与相关系数

#### 协方差

**定义**：

$$
\text{Cov}(X, Y) = E[(X - E[X])(Y - E[Y])] = E[XY] - E[X]E[Y]
$$

**计算公式**：

$$
\text{Cov}(X, Y) = E[XY] - E[X]E[Y]
$$

**性质**：

1. $\text{Cov}(X, X) = \text{Var}(X)$
2. $\text{Cov}(X, Y) = \text{Cov}(Y, X)$（对称性）
3. $\text{Cov}(aX + b, cY + d) = ac \cdot \text{Cov}(X, Y)$
4. $\text{Cov}(X + Y, Z) = \text{Cov}(X, Z) + \text{Cov}(Y, Z)$（双线性）
5. 若 $X, Y$ 独立，则 $\text{Cov}(X, Y) = 0$

**方差的可加性**：

$$
\text{Var}(X + Y) = \text{Var}(X) + \text{Var}(Y) + 2\text{Cov}(X, Y)
$$

推广：

$$
\text{Var}\left(\sum_{i=1}^{n} X_i\right) = \sum_{i=1}^{n} \text{Var}(X_i) + 2\sum_{i<j} \text{Cov}(X_i, X_j)
$$

#### 相关系数

**定义**：

$$
\rho_{XY} = \frac{\text{Cov}(X, Y)}{\sqrt{\text{Var}(X)} \sqrt{\text{Var}(Y)}} = \frac{\text{Cov}(X, Y)}{\sigma_X \sigma_Y}
$$

**性质**：

1. $-1 \leq \rho_{XY} \leq 1$
2. $|\rho_{XY}| = 1$ 当且仅当存在 $a, b$ 使得 $P(Y = aX + b) = 1$
   - $\rho = 1$：完全正相关（$a > 0$）
   - $\rho = -1$：完全负相关（$a < 0$）
   - $\rho = 0$：不相关
3. $\rho$ 仅衡量**线性相关性**

**独立 vs 不相关**：

$$
\text{独立} \Rightarrow \text{不相关} \quad (\text{但反之不一定})
$$

**反例**：设 $X \sim U[-1, 1]$，$Y = X^2$

则 $E[XY] = E[X^3] = 0 = E[X]E[Y]$，所以 $\text{Cov}(X, Y) = 0$（不相关）

但 $X$ 和 $Y$ 显然不独立（$Y$ 完全由 $X$ 决定）

**例6**：设 $(X, Y)$ 的联合分布为

| $X \backslash Y$ | -1 | 0 | 1 |
|------------------|----|----|---|
| -1 | 1/4 | 0 | 1/4 |
| 1 | 1/4 | 0 | 1/4 |

求 $\text{Cov}(X, Y)$ 和 $\rho_{XY}$。

**解**：

$$
E[X] = (-1) \times 0.5 + 1 \times 0.5 = 0
$$

$$
E[Y] = (-1) \times 0.5 + 1 \times 0.5 = 0
$$

$$
E[XY] = (-1)(-1) \times 0.25 + (-1)(1) \times 0.25 + (1)(-1) \times 0.25 + (1)(1) \times 0.25 = 0
$$

$$
\text{Cov}(X, Y) = E[XY] - E[X]E[Y] = 0
$$

所以 $\rho_{XY} = 0$，$X$ 和 $Y$ 不相关。

但 $P(X = -1, Y = 0) = 0 \neq P(X = -1)P(Y = 0) = 0.5 \times 0 = 0$（实际上这里 $P(Y=0)=0$，所以不独立）

### 3.7 随机变量的变换

#### 二维随机变量函数的分布

**离散型**：若 $Z = g(X, Y)$，则

$$
P(Z = z) = \sum_{g(x_i, y_j) = z} P(X = x_i, Y = y_j)
$$

**连续型**：若 $Z = X + Y$，则

$$
f_Z(z) = \int_{-\infty}^{+\infty} f(x, z-x) \, dx = \int_{-\infty}^{+\infty} f(z-y, y) \, dy
$$

若 $X, Y$ 独立：

$$
f_Z(z) = \int_{-\infty}^{+\infty} f_X(x) f_Y(z-x) \, dx = (f_X * f_Y)(z)
$$

（**卷积公式**）

#### 重要结论

**正态分布的线性组合**：

若 $X \sim N(\mu_1, \sigma_1^2)$，$Y \sim N(\mu_2, \sigma_2^2)$ 独立，则

$$
aX + bY \sim N(a\mu_1 + b\mu_2, a^2\sigma_1^2 + b^2\sigma_2^2)
$$

推广：若 $X_1, \ldots, X_n$ 独立，$X_i \sim N(\mu_i, \sigma_i^2)$，则

$$
\sum_{i=1}^{n} a_i X_i \sim N\left(\sum_{i=1}^{n} a_i \mu_i, \sum_{i=1}^{n} a_i^2 \sigma_i^2\right)
$$

**泊松分布的可加性**：

若 $X \sim \text{Poisson}(\lambda_1)$，$Y \sim \text{Poisson}(\lambda_2)$ 独立，则

$$
X + Y \sim \text{Poisson}(\lambda_1 + \lambda_2)
$$

**例7**：设 $X \sim N(1, 4)$，$Y \sim N(2, 9)$ 独立，求 $Z = 2X - Y + 3$ 的分布。

**解**：

$$
E[Z] = 2E[X] - E[Y] + 3 = 2 \times 1 - 2 + 3 = 3
$$

$$
\text{Var}(Z) = 2^2 \text{Var}(X) + (-1)^2 \text{Var}(Y) = 4 \times 4 + 9 = 25
$$

所以 $Z \sim N(3, 25)$

#### 变量替换（雅可比变换）

若 $(X, Y)$ 的联合PDF为 $f(x, y)$，变换

$$
U = g_1(X, Y), \quad V = g_2(X, Y)
$$

且变换一一对应，逆变换为

$$
X = h_1(U, V), \quad Y = h_2(U, V)
$$

则 $(U, V)$ 的联合PDF为

$$
f_{UV}(u, v) = f_{XY}(h_1(u, v), h_2(u, v)) \cdot |J|
$$

其中 $J$ 为雅可比行列式：

$$
J = \begin{vmatrix}
\frac{\partial x}{\partial u} & \frac{\partial x}{\partial v} \\
\frac{\partial y}{\partial u} & \frac{\partial y}{\partial v}
\end{vmatrix}
$$

**例8**（Box-Muller变换）：

设 $U, V \sim U(0, 1)$ 独立，令

$$
X = \sqrt{-2\ln U} \cos(2\pi V), \quad Y = \sqrt{-2\ln U} \sin(2\pi V)
$$

则 $X, Y \sim N(0, 1)$ 独立。

（这是生成标准正态随机数的经典方法）

### 3.8 多维正态分布

#### 定义

$n$ 维随机向量 $\mathbf{X} = (X_1, \ldots, X_n)^T$ 服从多维正态分布 $N(\boldsymbol{\mu}, \boldsymbol{\Sigma})$，若其联合PDF为

$$
f(\mathbf{x}) = \frac{1}{(2\pi)^{n/2} |\boldsymbol{\Sigma}|^{1/2}} \exp\left\{-\frac{1}{2}(\mathbf{x} - \boldsymbol{\mu})^T \boldsymbol{\Sigma}^{-1} (\mathbf{x} - \boldsymbol{\mu})\right\}
$$

其中：
- $\boldsymbol{\mu} = (E[X_1], \ldots, E[X_n])^T$：均值向量
- $\boldsymbol{\Sigma}$：协方差矩阵，$\Sigma_{ij} = \text{Cov}(X_i, X_j)$

#### 性质

1. **边缘分布**：$X_i \sim N(\mu_i, \sigma_i^2)$
2. **线性变换**：若 $\mathbf{X} \sim N(\boldsymbol{\mu}, \boldsymbol{\Sigma})$，则
   $$
   A\mathbf{X} + \mathbf{b} \sim N(A\boldsymbol{\mu} + \mathbf{b}, A\boldsymbol{\Sigma}A^T)
   $$
3. **独立性**：$X_i$ 和 $X_j$ 独立 $\Leftrightarrow$ $\text{Cov}(X_i, X_j) = 0$（仅对正态分布成立）
4. **条件分布**：条件分布仍为正态分布

### 3.9 应用实例

#### 应用1：特征相关性分析

在机器学习中，识别高度相关的特征对特征选择和降维至关重要。

```python
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns

def feature_correlation_analysis(X, feature_names=None):
    """
    特征相关性分析
    X: 特征矩阵 (n_samples, n_features)
    feature_names: 特征名称列表
    """
    n_features = X.shape[1]
    
    if feature_names is None:
        feature_names = [f'特征{i}' for i in range(n_features)]
    
    # 计算相关系数矩阵
    corr_matrix = np.corrcoef(X.T)
    
    # 可视化
    plt.figure(figsize=(10, 8))
    sns.heatmap(corr_matrix, annot=True, fmt='.2f', cmap='coolwarm', 
                square=True, cbar_kws={'label': '相关系数'},
                xticklabels=feature_names, yticklabels=feature_names)
    plt.title('特征相关性热力图')
    plt.tight_layout()
    # plt.show()
    
    # 找出高度相关的特征对
    threshold = 0.8
    high_corr_pairs = []
    
    for i in range(len(corr_matrix)):
        for j in range(i+1, len(corr_matrix)):
            if abs(corr_matrix[i, j]) > threshold:
                high_corr_pairs.append((i, j, corr_matrix[i, j]))
    
    print("=== 特征相关性分析 ===")
    print(f"特征数量: {n_features}")
    print(f"\n高度相关的特征对（|ρ| > {threshold}）:")
    if high_corr_pairs:
        for i, j, corr in high_corr_pairs:
            print(f"  {feature_names[i]} - {feature_names[j]}: {corr:.3f}")
            print(f"    建议：考虑删除其中一个特征以减少多重共线性")
    else:
        print("  未发现高度相关的特征对")
    
    # 计算条件数（衡量多重共线性）
    eigenvalues = np.linalg.eigvalsh(corr_matrix)
    condition_number = np.sqrt(eigenvalues.max() / eigenvalues.min())
    
    print(f"\n相关系数矩阵条件数: {condition_number:.2f}")
    if condition_number > 30:
        print("  警告：条件数较大，存在严重多重共线性！")
    elif condition_number > 10:
        print("  注意：条件数适中，存在一定多重共线性")
    else:
        print("  良好：条件数较小，多重共线性不明显")
    
    return corr_matrix

# 示例数据
np.random.seed(42)
n_samples = 100
n_features = 5

# 生成相关特征
X = np.random.randn(n_samples, n_features)
X[:, 1] = 0.9 * X[:, 0] + 0.3 * np.random.randn(n_samples)  # 特征1与特征0高度正相关
X[:, 3] = -0.85 * X[:, 2] + 0.4 * np.random.randn(n_samples)  # 特征3与特征2高度负相关

feature_names = ['身高', '体重', '年龄', '收入', '教育']
# corr_matrix = feature_correlation_analysis(X, feature_names)  # 取消注释运行
```

#### 应用2：投资组合优化（马科维茨模型）

使用协方差矩阵优化投资组合，平衡收益与风险。

```python
def portfolio_optimization(returns, risk_free_rate=0.02):
    """
    投资组合优化（简化版马科维茨模型）
    returns: 各资产收益率矩阵 (n_periods, n_assets)
    risk_free_rate: 无风险收益率
    """
    import numpy as np
    from scipy.optimize import minimize
    
    n_assets = returns.shape[1]
    
    # 计算期望收益和协方差矩阵
    mean_returns = np.mean(returns, axis=0)
    cov_matrix = np.cov(returns.T)
    
    print("=== 投资组合优化 ===")
    print(f"资产数量: {n_assets}")
    print(f"期望收益率: {mean_returns}")
    print(f"\n协方差矩阵:\n{cov_matrix}")
    
    # 目标函数：最小化组合方差
    def portfolio_variance(weights):
        return weights @ cov_matrix @ weights
    
    # 约束条件
    constraints = [
        {'type': 'eq', 'fun': lambda w: np.sum(w) - 1}  # 权重和为1
    ]
    
    # 边界条件（权重在0到1之间）
    bounds = tuple((0, 1) for _ in range(n_assets))
    
    # 初始权重（等权重）
    w0 = np.array([1/n_assets] * n_assets)
    
    # 优化
    result = minimize(portfolio_variance, w0, method='SLSQP',
                     bounds=bounds, constraints=constraints)
    
    optimal_weights = result.x
    optimal_return = optimal_weights @ mean_returns
    optimal_risk = np.sqrt(optimal_weights @ cov_matrix @ optimal_weights)
    sharpe_ratio = (optimal_return - risk_free_rate) / optimal_risk
    
    print(f"\n最优权重配置:")
    for i, w in enumerate(optimal_weights):
        print(f"  资产 {i+1}: {w*100:.2f}%")
    
    print(f"\n组合性能:")
    print(f"  期望收益率: {optimal_return*100:.2f}%")
    print(f"  风险（标准差）: {optimal_risk*100:.2f}%")
    print(f"  夏普比率: {sharpe_ratio:.3f}")
    
    return optimal_weights, optimal_return, optimal_risk

# 示例：3种资产的历史收益数据
np.random.seed(42)
n_periods = 252  # 一年交易日
n_assets = 3

# 模拟收益率（年化后）
returns = np.random.multivariate_normal(
    mean=[0.10/252, 0.08/252, 0.06/252],  # 日均收益
    cov=[[0.04/252, 0.01/252, 0.005/252],
         [0.01/252, 0.02/252, 0.008/252],
         [0.005/252, 0.008/252, 0.01/252]],
    size=n_periods
)

# weights, ret, risk = portfolio_optimization(returns)  # 取消注释运行
```

#### 应用3：多元正态分布的生成与可视化

```python
def multivariate_normal_demo():
    """演示二维正态分布"""
    import numpy as np
    import matplotlib.pyplot as plt
    from scipy.stats import multivariate_normal
    
    # 定义参数
    mu = np.array([0, 0])
    
    # 不同相关系数的协方差矩阵
    rho_values = [-0.8, 0, 0.8]
    
    fig, axes = plt.subplots(1, 3, figsize=(15, 4))
    
    for idx, rho in enumerate(rho_values):
        cov = np.array([[1, rho], [rho, 1]])
        
        # 生成网格
        x = np.linspace(-3, 3, 100)
        y = np.linspace(-3, 3, 100)
        X, Y = np.meshgrid(x, y)
        pos = np.dstack((X, Y))
        
        # 计算密度
        rv = multivariate_normal(mu, cov)
        Z = rv.pdf(pos)
        
        # 绘制等高线
        axes[idx].contour(X, Y, Z, levels=10, cmap='viridis')
        axes[idx].set_title(f'ρ = {rho}')
        axes[idx].set_xlabel('X')
        axes[idx].set_ylabel('Y')
        axes[idx].grid(alpha=0.3)
        axes[idx].axis('equal')
    
    plt.tight_layout()
    # plt.show()

# multivariate_normal_demo()  # 取消注释运行
```

### 3.10 本章小结

#### 核心概念

1. **联合分布**：$F(x, y) = P(X \leq x, Y \leq y)$
2. **边缘分布**：从联合分布求单个变量的分布
3. **条件分布**：$f_{X|Y}(x|y) = \frac{f(x,y)}{f_Y(y)}$
4. **独立性**：$f(x, y) = f_X(x) f_Y(y)$
5. **协方差**：$\text{Cov}(X, Y) = E[XY] - E[X]E[Y]$
6. **相关系数**：$\rho = \frac{\text{Cov}(X,Y)}{\sigma_X \sigma_Y}$，$-1 \leq \rho \leq 1$
7. **独立 vs 不相关**：独立 $\Rightarrow$ 不相关，反之不一定

#### 重要公式

**方差的可加性**：

$$
\text{Var}(X + Y) = \text{Var}(X) + \text{Var}(Y) + 2\text{Cov}(X, Y)
$$

**正态分布的线性组合**：

$$
X \sim N(\mu_1, \sigma_1^2), Y \sim N(\mu_2, \sigma_2^2) \text{ 独立} \Rightarrow aX + bY \sim N(a\mu_1 + b\mu_2, a^2\sigma_1^2 + b^2\sigma_2^2)
$$

**卷积公式**（$X, Y$ 独立时）：

$$
f_{X+Y}(z) = \int_{-\infty}^{+\infty} f_X(x) f_Y(z-x) \, dx
$$

**二维正态分布的性质**：

- 边缘分布为正态分布
- 对于正态分布：不相关 $\Leftrightarrow$ 独立

#### 常见题型

**类型1**：求边缘分布
- 离散型：按行/列求和
- 连续型：对另一变量积分

**类型2**：判断独立性
- 检验 $f(x, y) = f_X(x) f_Y(y)$
- 或检验积分域是否为矩形且密度可分离

**类型3**：求协方差/相关系数
- 计算 $E[X]$, $E[Y]$, $E[XY]$
- 用公式 $\text{Cov}(X, Y) = E[XY] - E[X]E[Y]$

**类型4**：随机变量函数的分布
- $Z = X + Y$：用卷积公式
- 一般变换：雅可比变换

#### 易错点

1. **独立 ≠ 不相关**（正态分布除外）
2. **边缘分布无法唯一确定联合分布**
3. **积分域不是矩形时要小心独立性判断**
4. **协方差矩阵必须半正定**

---

**本章完**
