# 数据库系统 - (三)数据库设计

学习ER模型与范式。

---

## 3. 数据库设计

### 3.1 ER图设计

```
[Student] 1──────N [Enrollment] N──────1 [Course]
   |                                        |
   |                                        |
  sid                                      cid
  name                                     course_name
  age                                      credits
```

**转换为关系模式：**

```sql
Student(sid, name, age)
Course(cid, course_name, credits)
Enrollment(eid, sid, cid, grade)
    FK: sid → Student.sid
    FK: cid → Course.cid
```

### 3.2 范式理论

#### 第一范式（1NF）

**要求**：每个属性不可再分

❌ 错误：
```
Student(sid, name, courses)  -- courses: "Math,CS,Physics"
```

✅ 正确：
```
Student(sid, name)
Enrollment(sid, course)
```

#### 第二范式（2NF）

**要求**：消除部分函数依赖

❌ 错误：
```
Enrollment(sid, cid, sname, cname, grade)
-- sname依赖于sid，cname依赖于cid
```

✅ 正确：
```
Student(sid, sname)
Course(cid, cname)
Enrollment(sid, cid, grade)
```

#### 第三范式（3NF）

**要求**：消除传递依赖

❌ 错误：
```
Student(sid, name, dept_id, dept_name)
-- dept_name传递依赖于sid（通过dept_id）
```

✅ 正确：
```
Student(sid, name, dept_id)
Department(dept_id, dept_name)
```

#### BCNF（Boyce-Codd范式）

**要求**：每个决定因素都包含候选键

```python
def check_bcnf(relation, functional_dependencies):
    """
    检查BCNF
    """
    for fd in functional_dependencies:
        determinant, dependent = fd.split('->')
        # 检查determinant是否为超键
        if not is_superkey(determinant, relation):
            return False, f"违反BCNF: {fd}"
    return True, "满足BCNF"
```

---

**本章完**
