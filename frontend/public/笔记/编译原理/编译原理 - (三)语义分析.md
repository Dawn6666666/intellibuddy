# 编译原理 - (三)语义分析

理解语义分析过程。

---

## 3. 语义分析

### 3.1 符号表

```python
class SymbolTable:
    def __init__(self):
        self.symbols = {}
    
    def define(self, name, symbol_type, value=None):
        """定义符号"""
        self.symbols[name] = {
            'type': symbol_type,
            'value': value
        }
    
    def lookup(self, name):
        """查找符号"""
        return self.symbols.get(name)
    
    def exists(self, name):
        """检查符号是否存在"""
        return name in self.symbols

# 类型检查器
class TypeChecker:
    def __init__(self):
        self.symbol_table = SymbolTable()
    
    def check_assignment(self, var_name, expr_type):
        """检查赋值类型兼容性"""
        if self.symbol_table.exists(var_name):
            var_type = self.symbol_table.lookup(var_name)['type']
            if var_type != expr_type:
                raise Exception(f'Type mismatch: {var_type} vs {expr_type}')
        else:
            self.symbol_table.define(var_name, expr_type)
```

---

**本章完**
