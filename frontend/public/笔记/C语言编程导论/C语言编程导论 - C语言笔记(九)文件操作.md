# æ–‡ä»¶æ“ä½œç¯‡

æ–‡ä»¶æ“ä½œä½¿ç¨‹åºèƒ½å¤Ÿæ°¸ä¹…ä¿å­˜æ•°æ®,æ˜¯å®ç”¨ç¨‹åºçš„å¿…å¤‡æŠ€èƒ½ã€‚

---

## 9. æ–‡ä»¶æ“ä½œ
ç¨‹åºè¿è¡Œåœ¨å†…å­˜ä¸­ï¼Œæ‰€æœ‰æ•°æ®åœ¨ç¨‹åºç»“æŸåéƒ½ä¼šä¸¢å¤±ã€‚ä¸ºäº†æ°¸ä¹…æ€§åœ°ä¿å­˜æ•°æ®ï¼Œæˆ‘ä»¬éœ€è¦å°†å…¶å†™å…¥**æ–‡ä»¶**ã€‚æ–‡ä»¶æ“ä½œå…è®¸Cç¨‹åºè¯»å–ç¡¬ç›˜ä¸Šçš„æ–‡ä»¶å†…å®¹åˆ°å†…å­˜ï¼Œæˆ–å°†å†…å­˜ä¸­çš„æ•°æ®å†™å…¥ç¡¬ç›˜ä¸Šçš„æ–‡ä»¶ã€‚

**æ·±åº¦åŸç†è®²è§£**

åœ¨Cè¯­è¨€ä¸­ï¼Œæˆ‘ä»¬ä¸ç›´æ¥æ“ä½œç‰©ç†æ–‡ä»¶ï¼Œè€Œæ˜¯é€šè¿‡ä¸€ä¸ªå«åš**æ–‡ä»¶æµ (File Stream)** çš„æŠ½è±¡å±‚æ¥äº¤äº’ã€‚å½“ä½ æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶æ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šä¸ºä½ åˆ›å»ºä¸€ä¸ªæ•°æ®ç»“æ„ï¼Œå…¶ä¸­åŒ…å«äº†æ–‡ä»¶çš„ä¿¡æ¯ã€ä¸€ä¸ªæŒ‡å‘**ç¼“å†²åŒº (Buffer)** çš„æŒ‡é’ˆä»¥åŠå½“å‰è¯»å†™ä½ç½®ç­‰ã€‚Cè¯­è¨€ä¸­çš„ `FILE` ç»“æ„ä½“å°±æ˜¯è¿™ä¸ªæ•°æ®ç»“æ„çš„ä»£è¡¨ã€‚

+ `FILE*` **(æ–‡ä»¶æŒ‡é’ˆ)**ï¼šå®ƒä¸æ˜¯æŒ‡å‘æ–‡ä»¶å†…å®¹çš„æŒ‡é’ˆï¼Œè€Œæ˜¯æŒ‡å‘è¿™ä¸ª `FILE` ç®¡ç†ç»“æ„ä½“çš„æŒ‡é’ˆã€‚æˆ‘ä»¬é€šè¿‡è¿™ä¸ªæŒ‡é’ˆæ¥é—´æ¥æ“ä½œæ–‡ä»¶ã€‚
+ **ç¼“å†²åŒº (Buffer)**ï¼šä¸ºäº†æé«˜æ•ˆç‡ï¼ŒI/Oæ“ä½œé€šå¸¸ä¸æ˜¯ä¸€ä¸ªå­—èŠ‚ä¸€ä¸ªå­—èŠ‚åœ°ç›´æ¥è¯»å†™ç¡¬ç›˜ã€‚æ•°æ®ä¼šè¢«å…ˆè¯»å…¥/å†™å…¥å†…å­˜ä¸­çš„ä¸€å—ç¼“å†²åŒºï¼Œå½“ç¼“å†²åŒºæ»¡äº†æˆ–è€…ä½ å¼ºåˆ¶åˆ·æ–°æ—¶ï¼Œæ‰ä¼šè¿›è¡Œå®é™…çš„ç¡¬ç›˜è¯»å†™ã€‚è¿™å¤§å¤§å‡å°‘äº†æ˜‚è´µçš„ç³»ç»Ÿè°ƒç”¨æ¬¡æ•°ã€‚

### 9.1 æ–‡ä»¶åŸºç¡€
#### æ–‡ä»¶æŒ‡é’ˆä¸æ‰“å¼€æ¨¡å¼
è¦å¯¹æ–‡ä»¶è¿›è¡Œæ“ä½œï¼Œç¬¬ä¸€æ­¥æ˜¯ä½¿ç”¨ `fopen` å‡½æ•°æ‰“å¼€å®ƒï¼Œè·å–ä¸€ä¸ªæ–‡ä»¶æŒ‡é’ˆã€‚

+ **åŸå‹**ï¼š`FILE* fopen(const char* filename, const char* mode);`
+ **è¿”å›å€¼**ï¼š
    - æˆåŠŸï¼šè¿”å›ä¸€ä¸ªæŒ‡å‘ `FILE` ç»“æ„ä½“çš„æŒ‡é’ˆã€‚
    - å¤±è´¥ï¼ˆå¦‚æ–‡ä»¶ä¸å­˜åœ¨ã€æƒé™ä¸è¶³ï¼‰ï¼šè¿”å› `NULL`ã€‚

**å¸¸ç”¨æ–‡ä»¶æ‰“å¼€æ¨¡å¼ (`mode`)**

| æ¨¡å¼ | æè¿° | æ–‡ä»¶ä¸å­˜åœ¨æ—¶ | æ–‡ä»¶å­˜åœ¨æ—¶ |
| :--- | :--- | :--- | :--- |
| `"r"` | **è¯» (Read)**ï¼šæ‰“å¼€ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œåªå…è®¸è¯»å–ã€‚ | æ‰“å¼€å¤±è´¥ (è¿”å›`NULL`) | ä»æ–‡ä»¶å¼€å¤´è¯»å– |
| `"w"` | **å†™ (Write)**ï¼šæ‰“å¼€ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œåªå…è®¸å†™å…¥ã€‚ | åˆ›å»ºæ–°æ–‡ä»¶ | **æ¸…ç©ºæ–‡ä»¶å†…å®¹**åå†™å…¥ |
| `"a"` | **è¿½åŠ  (Append)**ï¼šæ‰“å¼€ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œåœ¨æœ«å°¾è¿½åŠ å†…å®¹ã€‚ | åˆ›å»ºæ–°æ–‡ä»¶ | ä»æ–‡ä»¶æœ«å°¾å†™å…¥ |
| `"rb"` | **äºŒè¿›åˆ¶è¯»** | åŒ `"r"` | åŒ `"r"` |
| `"wb"` | **äºŒè¿›åˆ¶å†™** | åŒ `"w"` | åŒ `"w"` |
| `"ab"` | **äºŒè¿›åˆ¶è¿½åŠ ** | åŒ `"a"` | åŒ `"a"` |
| `"r+"` | **è¯»å†™**ï¼šæ‰“å¼€æ–‡æœ¬æ–‡ä»¶è¿›è¡Œè¯»å†™ã€‚ | æ‰“å¼€å¤±è´¥ | ä»æ–‡ä»¶å¼€å¤´è¯»å†™ |
| `"w+"` | **è¯»å†™**ï¼šæ‰“å¼€æ–‡æœ¬æ–‡ä»¶è¿›è¡Œè¯»å†™ã€‚ | åˆ›å»ºæ–°æ–‡ä»¶ | **æ¸…ç©ºæ–‡ä»¶å†…å®¹**åè¯»å†™ |
| `"a+"` | **è¯»å†™**ï¼šæ‰“å¼€æ–‡æœ¬æ–‡ä»¶è¿›è¡Œè¯»å†™ã€‚ | åˆ›å»ºæ–°æ–‡ä»¶ | ä»æœ«å°¾è¿½åŠ ï¼Œå¯è¯» |


> **æ·±åº¦è¾¨æï¼šæ–‡æœ¬æ¨¡å¼ vs. äºŒè¿›åˆ¶æ¨¡å¼**
>
> + **æ–‡æœ¬æ¨¡å¼ (`"r"`, `"w"`, ...)**ï¼šä¼šè‡ªåŠ¨å¤„ç†ä¸åŒæ“ä½œç³»ç»Ÿä¸‹**æ¢è¡Œç¬¦**çš„è½¬æ¢ã€‚ä¾‹å¦‚ï¼Œåœ¨Windowsä¸Šå†™å…¥ `\n`ï¼Œå®é™…å­˜å…¥æ–‡ä»¶çš„æ˜¯ `\r\n` (å›è½¦+æ¢è¡Œ)ï¼›è¯»å– `\r\n` æ—¶ï¼Œä¼šè‡ªåŠ¨è½¬æ¢å› `\n`ã€‚è¿™å¯¹äºå¤„ç†çº¯æ–‡æœ¬å¾ˆæ–¹ä¾¿ã€‚
> + **äºŒè¿›åˆ¶æ¨¡å¼ (`"rb"`, `"wb"`, ...)**ï¼š**æ‰€è§å³æ‰€å¾—**ã€‚ç¨‹åºå†™å…¥ä»€ä¹ˆå­—èŠ‚ï¼Œæ–‡ä»¶å°±å­˜å‚¨ä»€ä¹ˆå­—èŠ‚ï¼Œä¸åšä»»ä½•è½¬æ¢ã€‚è¿™å¯¹äºå¤„ç†éæ–‡æœ¬æ–‡ä»¶ï¼ˆå¦‚å›¾ç‰‡ã€éŸ³é¢‘ã€ç»“æ„ä½“æ•°æ®ï¼‰è‡³å…³é‡è¦ã€‚
>

#### `fopen` ä¸ `fclose`
**é»„é‡‘æ³•åˆ™**ï¼šæ¯ä¸€ä¸ªæˆåŠŸçš„ `fopen` éƒ½å¿…é¡»å¯¹åº”ä¸€ä¸ª `fclose`ã€‚å¿˜è®°å…³é—­æ–‡ä»¶ä¼šå¯¼è‡´**æ–‡ä»¶å¥æŸ„æ³„æ¼**ï¼Œå½“ç¨‹åºæ‰“å¼€è¿‡å¤šæ–‡ä»¶è€Œæœªå…³é—­æ—¶ï¼Œæœ€ç»ˆå°†æ— æ³•å†æ‰“å¼€ä»»ä½•æ–°æ–‡ä»¶ã€‚

**ä»£ç ç¤ºä¾‹ 1ï¼šåŸºæœ¬çš„æ–‡ä»¶æ‰“å¼€ä¸å…³é—­**

```c
#include <stdio.h>

int main() {
    FILE *fp = NULL;
    
    // å°è¯•ä»¥å†™å…¥æ¨¡å¼æ‰“å¼€æ–‡ä»¶
    fp = fopen("test.txt", "w");
    
    // é»„é‡‘æ³•åˆ™ï¼šæ°¸è¿œåœ¨ä½¿ç”¨æ–‡ä»¶æŒ‡é’ˆå‰æ£€æŸ¥å…¶æ˜¯å¦ä¸º NULL
    if (fp == NULL) {
        perror("æ–‡ä»¶æ‰“å¼€å¤±è´¥"); // perrorä¼šæ‰“å°å‡ºå…·ä½“çš„ç³»ç»Ÿé”™è¯¯ä¿¡æ¯
        return 1;
    }
    
    printf("æ–‡ä»¶ test.txt æ‰“å¼€æˆåŠŸï¼\n");
    
    // ... åœ¨è¿™é‡Œè¿›è¡Œæ–‡ä»¶è¯»å†™æ“ä½œ ...
    fprintf(fp, "Hello, File!\n");
    
    // é»„é‡‘æ³•åˆ™ï¼šæ“ä½œå®Œæˆåï¼ŒåŠ¡å¿…å…³é—­æ–‡ä»¶
    fclose(fp);
    fp = NULL; // å¥½ä¹ æƒ¯ï¼šå…³é—­åå°†æŒ‡é’ˆç½®ç©º
    
    printf("æ–‡ä»¶å·²å…³é—­ã€‚\n");
    
    return 0;
}
```

### 9.2 æ–‡æœ¬æ–‡ä»¶æ“ä½œ
#### å†™å…¥æ–‡æœ¬æ–‡ä»¶ (`fprintf`, `fputs`, `fputc`)
+ `fprintf(fp, format, ...)`ï¼šåŠŸèƒ½ä¸ `printf` ç±»ä¼¼ï¼Œåªæ˜¯å°†å†…å®¹è¾“å‡ºåˆ°æŒ‡å®šçš„æ–‡ä»¶æµã€‚
+ `fputs(str, fp)`ï¼šå°†ä¸€ä¸ªå­—ç¬¦ä¸²å†™å…¥æ–‡ä»¶ï¼ˆä¸è‡ªåŠ¨æ·»åŠ æ¢è¡Œç¬¦ï¼‰ã€‚
+ `fputc(char, fp)`ï¼šå°†ä¸€ä¸ªå­—ç¬¦å†™å…¥æ–‡ä»¶ã€‚

**ä»£ç ç¤ºä¾‹ 2ï¼šå¤šç§æ–¹å¼å†™å…¥æ–‡æœ¬**

```c
#include <stdio.h>

int main() {
    FILE *fp = fopen("students.txt", "w");
    if (fp == NULL) return 1;
    
    // ä½¿ç”¨ fprintf å†™å…¥æ ¼å¼åŒ–æ•°æ®
    fprintf(fp, "ID\tName\tScore\n");
    fprintf(fp, "1001\tTom\t85.5\n");
    fprintf(fp, "1002\tJerry\t92.0\n");
    
    // ä½¿ç”¨ fputs å†™å…¥ä¸€è¡Œ
    fputs("------------------\n", fp);
    
    // ä½¿ç”¨ fputc é€å­—ç¬¦å†™å…¥
    char signature[] = "END";
    for (int i=0; signature[i] != '\0'; i++) {
        fputc(signature[i], fp);
    }
    fputc('\n', fp);
    
    fclose(fp);
    printf("å­¦ç”Ÿä¿¡æ¯å·²å†™å…¥æ–‡ä»¶ students.txtï¼\n");
    return 0;
}
```

#### è¯»å–æ–‡æœ¬æ–‡ä»¶ (`fscanf`, `fgets`, `fgetc`)
+ `fscanf(fp, format, ...)`ï¼šåŠŸèƒ½ä¸ `scanf` ç±»ä¼¼ï¼Œä»æ–‡ä»¶æµè¯»å–æ ¼å¼åŒ–æ•°æ®ã€‚
+ `fgets(buffer, size, fp)`ï¼šä»æ–‡ä»¶è¯»å–ä¸€è¡Œï¼ˆæœ€å¤š`size-1`ä¸ªå­—ç¬¦ï¼‰ï¼Œå­˜å…¥`buffer`ã€‚æ¯” `fscanf` æ›´å®‰å…¨ï¼Œèƒ½è¯»å–åŒ…å«ç©ºæ ¼çš„è¡Œã€‚
+ `fgetc(fp)`ï¼šä»æ–‡ä»¶è¯»å–ä¸€ä¸ªå­—ç¬¦ã€‚

**ä»£ç ç¤ºä¾‹ 3ï¼šé€è¡Œè¯»å–ä¸æ ¼å¼åŒ–è¯»å–**

```c
#include <stdio.h>

int main() {
    FILE *fp = fopen("students.txt", "r");
    if (fp == NULL) {
        perror("æ–‡ä»¶æ‰“å¼€å¤±è´¥");
        return 1;
    }
    
    printf("=== æ–¹æ³•1ï¼šé€è¡Œè¯»å– (fgets) ===\n");
    char line_buffer[100];
    while (fgets(line_buffer, sizeof(line_buffer), fp) != NULL) {
        printf("%s", line_buffer); // fgets ä¿ç•™äº†è¡Œæœ«çš„æ¢è¡Œç¬¦
    }
    
    // rewind å°†æ–‡ä»¶æŒ‡é’ˆé‡ç½®åˆ°æ–‡ä»¶å¼€å¤´
    rewind(fp);
    
    printf("\n=== æ–¹æ³•2ï¼šæ ¼å¼åŒ–è¯»å– (fscanf) ===\n");
    int id;
    char name[20];
    float score;
    
    // è·³è¿‡è¡¨å¤´
    char header_buffer[100];
    fgets(header_buffer, sizeof(header_buffer), fp); 
    
    // fscanf æŒ‰æ ¼å¼è¯»å–ï¼Œé‡åˆ°ä¸åŒ¹é…çš„æ ¼å¼ä¼šåœæ­¢
    // è¿”å›å€¼ä¸ºæˆåŠŸåŒ¹é…å¹¶èµ‹å€¼çš„å˜é‡ä¸ªæ•°
    while (fscanf(fp, "%d\t%s\t%f", &id, name, &score) == 3) {
        printf("è¯»å–åˆ°: å­¦å·=%d, å§“å=%s, æˆç»©=%.1f\n", id, name, score);
    }
    
    fclose(fp);
    return 0;
}
```

> **ğŸ›**** å¸¸è§Bug**: `fscanf` åœ¨è¯»å–å­—ç¬¦ä¸² (`%s`) æ—¶ï¼Œé‡åˆ°ç©ºç™½ç¬¦ï¼ˆç©ºæ ¼ã€åˆ¶è¡¨ç¬¦ã€æ¢è¡Œç¬¦ï¼‰å°±ä¼šåœæ­¢ã€‚å¦‚æœå§“åæ˜¯ "Tom Hanks"ï¼Œ`fscanf` åªä¼šè¯»å– "Tom"ã€‚`fgets` æ˜¯è¯»å–æ•´è¡Œçš„æ›´å¥½é€‰æ‹©ã€‚
>

### 9.3 äºŒè¿›åˆ¶æ–‡ä»¶æ“ä½œ
äºŒè¿›åˆ¶I/Oç”¨äºè¯»å†™éæ–‡æœ¬æ•°æ®ï¼Œå¦‚ç»“æ„ä½“ã€æ•°ç»„ã€å›¾åƒç­‰ã€‚å®ƒèƒ½ç²¾ç¡®åœ°è¯»å†™å†…å­˜ä¸­çš„å­—èŠ‚åºåˆ—ï¼Œæ— ä»»ä½•è½¬æ¢ï¼Œé€Ÿåº¦ä¹Ÿæ›´å¿«ã€‚

+ `fwrite(ptr, size, count, fp)`ï¼šå°† `ptr` æŒ‡å‘çš„å†…å­˜å—ä¸­çš„ `count` ä¸ªã€æ¯ä¸ªå¤§å°ä¸º `size` å­—èŠ‚çš„æ•°æ®é¡¹å†™å…¥æ–‡ä»¶ã€‚
+ `fread(ptr, size, count, fp)`ï¼šä»æ–‡ä»¶ä¸­è¯»å– `count` ä¸ªã€æ¯ä¸ªå¤§å°ä¸º `size` å­—èŠ‚çš„æ•°æ®é¡¹ï¼Œå­˜å…¥ `ptr` æŒ‡å‘çš„å†…å­˜å—ã€‚

#### å†™å…¥äºŒè¿›åˆ¶æ•°æ®
**ä»£ç ç¤ºä¾‹ 4ï¼šå°†ç»“æ„ä½“æ•°ç»„å†™å…¥äºŒè¿›åˆ¶æ–‡ä»¶**

```c
#include <stdio.h>
#include <stdlib.h>

typedef struct {
    int id;
    char name[20];
    float score;
} Student;

int main() {
    FILE *fp = fopen("students.dat", "wb"); // 'wb' -> write binary
    if (fp == NULL) return 1;
    
    Student students[] = {
        {1001, "Tom", 85.5f},
        {1002, "Jerry", 92.0f},
        {1003, "Spike", 78.5f}
    };
    
    int count = sizeof(students) / sizeof(Student);
    
    // å°†æ•´ä¸ªæ•°ç»„ä¸€æ¬¡æ€§å†™å…¥æ–‡ä»¶
    size_t written_count = fwrite(students, sizeof(Student), count, fp);
    
    if (written_count == count) {
        printf("æˆåŠŸå°† %d æ¡å­¦ç”Ÿè®°å½•å†™å…¥äºŒè¿›åˆ¶æ–‡ä»¶ students.dat\n", count);
    }
    
    fclose(fp);
    return 0;
}
```

#### è¯»å–äºŒè¿›åˆ¶æ•°æ®
**ä»£ç ç¤ºä¾‹ 5ï¼šä»äºŒè¿›åˆ¶æ–‡ä»¶è¯»å–ç»“æ„ä½“æ•°ç»„**

```c
#include <stdio.h>
#include <stdlib.h>

// Student ç»“æ„ä½“å®šä¹‰éœ€ä¸å†™å…¥æ—¶å®Œå…¨ä¸€è‡´
typedef struct {
    int id;
    char name[20];
    float score;
} Student;

int main() {
    FILE *fp = fopen("students.dat", "rb"); // 'rb' -> read binary
    if (fp == NULL) {
        perror("æ— æ³•æ‰“å¼€äºŒè¿›åˆ¶æ–‡ä»¶");
        return 1;
    }
    
    Student students[10]; // å‡è®¾æœ€å¤šè¯»å–10æ¡
    
    // ä¸€æ¬¡æ€§è¯»å–æœ€å¤š10æ¡è®°å½•
    size_t read_count = fread(students, sizeof(Student), 10, fp);
    
    printf("ä»æ–‡ä»¶æˆåŠŸè¯»å– %zu æ¡è®°å½•:\n", read_count);
    
    for (int i = 0; i < read_count; i++) {
        printf("ID: %d, å§“å: %s, æˆç»©: %.1f\n",
               students[i].id, students[i].name, students[i].score);
    }
    
    fclose(fp);
    return 0;
}
```

### 9.4 æ–‡ä»¶å®šä½
æœ‰æ—¶æˆ‘ä»¬éœ€è¦éšæœºè®¿é—®æ–‡ä»¶ä¸­çš„ä»»æ„ä½ç½®ï¼Œè€Œä¸æ˜¯ä»å¤´åˆ°å°¾é¡ºåºè¯»å†™ã€‚

+ `fseek(fp, offset, whence)`ï¼šç§»åŠ¨æ–‡ä»¶æŒ‡é’ˆã€‚
    - `offset`ï¼šåç§»é‡ï¼ˆå­—èŠ‚æ•°ï¼‰ï¼Œå¯æ­£å¯è´Ÿã€‚
    - `whence`ï¼šèµ·å§‹ä½ç½®ã€‚
        * `SEEK_SET`ï¼šä»æ–‡ä»¶å¼€å¤´ã€‚
        * `SEEK_CUR`ï¼šä»å½“å‰ä½ç½®ã€‚
        * `SEEK_END`ï¼šä»æ–‡ä»¶æœ«å°¾ã€‚
+ `ftell(fp)`ï¼šè¿”å›æ–‡ä»¶æŒ‡é’ˆç›¸å¯¹äºæ–‡ä»¶å¼€å¤´çš„å½“å‰ä½ç½®ï¼ˆå­—èŠ‚æ•°ï¼‰ã€‚
+ `rewind(fp)`ï¼šå°†æ–‡ä»¶æŒ‡é’ˆç§»å›æ–‡ä»¶å¼€å¤´ï¼ˆç­‰ä»·äº `fseek(fp, 0, SEEK_SET)`ï¼‰ã€‚

**ä»£ç ç¤ºä¾‹ 6ï¼šéšæœºè®¿é—®äºŒè¿›åˆ¶æ–‡ä»¶è®°å½•**

```c
#include <stdio.h>

typedef struct {
    int id;
    char name[20];
    float score;
} Student;

int main() {
    FILE *fp = fopen("students.dat", "rb");
    if (fp == NULL) return 1;
    
    // è·å–æ–‡ä»¶å¤§å°æ¥è®¡ç®—è®°å½•æ€»æ•°
    fseek(fp, 0, SEEK_END);
    long file_size = ftell(fp);
    int record_count = file_size / sizeof(Student);
    printf("æ–‡ä»¶å¤§å°: %ld å­—èŠ‚, åŒ…å« %d æ¡è®°å½•ã€‚\n", file_size, record_count);

    // è¯»å–æœ€åä¸€æ¡è®°å½• (è®°å½•ç´¢å¼•ä¸º record_count - 1)
    int record_index = record_count - 1;
    fseek(fp, record_index * sizeof(Student), SEEK_SET);

    Student s;
    if (fread(&s, sizeof(Student), 1, fp) == 1) {
        printf("æœ€åä¸€æ¡è®°å½•: ID=%d, å§“å=%s, æˆç»©=%.1f\n", s.id, s.name, s.score);
    }

    // è¯»å–ç¬¬äºŒæ¡è®°å½• (ç´¢å¼•ä¸º1)
    fseek(fp, 1 * sizeof(Student), SEEK_SET);
    if (fread(&s, sizeof(Student), 1, fp) == 1) {
        printf("ç¬¬äºŒæ¡è®°å½•: ID=%d, å§“å=%s, æˆç»©=%.1f\n", s.id, s.name, s.score);
    }
    
    fclose(fp);
    return 0;
}
```

### 9.5 é”™è¯¯å¤„ç†ä¸æ–‡ä»¶çŠ¶æ€
+ `perror(const char *s)`ï¼šå½“ç³»ç»Ÿè°ƒç”¨ï¼ˆå¦‚ `fopen`ï¼‰å¤±è´¥æ—¶ï¼Œ`perror` ä¼šæ‰“å°ä½ æä¾›çš„å­—ç¬¦ä¸² `s`ï¼Œåè·Ÿä¸€ä¸ªå†’å·ã€ä¸€ä¸ªç©ºæ ¼ï¼Œä»¥åŠå¯¹å…¨å±€å˜é‡ `errno` ä¸­é”™è¯¯ç çš„æ–‡å­—æè¿°ã€‚
+ `feof(fp)`ï¼šæ£€æŸ¥æ–‡ä»¶æŒ‡é’ˆæ˜¯å¦å·²åˆ°è¾¾æ–‡ä»¶**æœ«å°¾**ã€‚
+ `ferror(fp)`ï¼šæ£€æŸ¥åœ¨æ–‡ä»¶è¯»å†™è¿‡ç¨‹ä¸­æ˜¯å¦å‘ç”Ÿäº†**é”™è¯¯**ï¼ˆå¦‚ç¡¬ç›˜å·²æ»¡ï¼‰ã€‚

**ä»£ç ç¤ºä¾‹ 7ï¼šå®Œå–„çš„é”™è¯¯æ£€æŸ¥**

```c
#include <stdio.h>
#include <errno.h>
#include <string.h>

int main() {
    FILE *fp = fopen("nonexistent_file.txt", "r");
    
    if (fp == NULL) {
        // æ–¹æ³•1ï¼šä½¿ç”¨ perror
        perror("fopen é”™è¯¯");
        
        // æ–¹æ³•2ï¼šä½¿ç”¨ strerror
        printf("é”™è¯¯è¯¦æƒ…: %s (é”™è¯¯ç : %d)\n", strerror(errno), errno);
        return 1;
    }
    
    int c;
    while ((c = fgetc(fp)) != EOF) {
        // ...
    }

    // å¾ªç¯ç»“æŸåï¼Œéœ€è¦åˆ¤æ–­æ˜¯æ­£å¸¸åˆ°è¾¾æ–‡ä»¶æœ«å°¾è¿˜æ˜¯å‘ç”Ÿäº†é”™è¯¯
    if (feof(fp)) {
        printf("å·²æˆåŠŸè¯»å–åˆ°æ–‡ä»¶æœ«å°¾ã€‚\n");
    } else if (ferror(fp)) {
        printf("åœ¨è¯»å–æ–‡ä»¶æ—¶å‘ç”Ÿé”™è¯¯ã€‚\n");
    }
    
    fclose(fp);
    return 0;
}
```

### ğŸ’¡ æ–‡ä»¶æ“ä½œæœ€ä½³å®è·µï¼š
1. **æ°¸è¿œæ£€æŸ¥ **`fopen`** çš„è¿”å›å€¼**ï¼šè¿™æ˜¯æœ€åŸºæœ¬ä¹Ÿæ˜¯æœ€é‡è¦çš„é˜²å¾¡æ€§ç¼–ç¨‹ã€‚
2. **åŠæ—¶å…³é—­æ–‡ä»¶ **`fclose`ï¼šä½¿ç”¨ `RAII` (Resource Acquisition Is Initialization) æ€æƒ³ï¼Œåœ¨æ‰“å¼€æ–‡ä»¶åï¼Œæœ€å¥½èƒ½é¢„è§åˆ°å®ƒå°†åœ¨ä½•å¤„è¢«å…³é—­ã€‚
3. **äºŒè¿›åˆ¶æ•°æ®ç”¨äºŒè¿›åˆ¶æ¨¡å¼**ï¼šå¤„ç†éçº¯ASCIIæ–‡æœ¬æ—¶ï¼ŒåšæŒä½¿ç”¨ `"rb"`, `"wb"` ç­‰æ¨¡å¼ï¼Œé¿å…æ•°æ®æŸåã€‚
4. **ä½¿ç”¨ **`fgets`** è¯»å–æ–‡æœ¬è¡Œ**ï¼šå®ƒæ¯” `fscanf` æ›´å®‰å…¨ï¼Œèƒ½å¤„ç†ç©ºæ ¼å¹¶é˜²æ­¢ç¼“å†²åŒºæº¢å‡ºã€‚
5. **æ˜ç¡®é”™è¯¯æ¥æº**ï¼šå¾ªç¯ç»“æŸåä½¿ç”¨ `feof` å’Œ `ferror` æ¥åŒºåˆ†æ˜¯æ­£å¸¸ç»“æŸè¿˜æ˜¯ I/O é”™è¯¯ã€‚
6. **å¤§æ–‡ä»¶åˆ†å—å¤„ç†**ï¼šä¸è¦è¯•å›¾ä¸€æ¬¡æ€§å°†Gçº§åˆ«çš„å¤§æ–‡ä»¶è¯»å…¥å†…å­˜ï¼Œåº”ä½¿ç”¨å¾ªç¯å’Œç¼“å†²åŒºï¼Œä¸€å—ä¸€å—åœ°å¤„ç†ã€‚

---

**æœ¬ç« å®Œ**
