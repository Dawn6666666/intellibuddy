# 智学伴 - 上线前检查清单

> 📋 在正式部署到生产环境前，请逐项检查以下内容

## 一、环境配置检查

### ✅ 后端环境变量（Vercel）

- [ ] `NODE_ENV` = `production`
- [ ] `MONGO_URI` 已配置（MongoDB Atlas连接串）
- [ ] `JWT_SECRET` 已设置强随机密钥（32位以上）
- [ ] `FRONTEND_URL` 和 `BACKEND_URL` 已设置为生产域名
- [ ] 至少配置一个 AI 模型的 API Key (`KIMI_API_KEY` 等)
- [ ] `PRIMARY_AI_MODEL` 已指定
- [ ] `ENABLE_AI_CACHE` = `true` (节省成本)
- [ ] `TRUST_PROXY` = `true`

### ✅ 第三方服务配置（可选）

- [ ] GitHub OAuth 配置（如需启用GitHub登录）
  - `GITHUB_CLIENT_ID` 和 `GITHUB_CLIENT_SECRET` 已配置
  - GitHub App 回调URL已更新为生产环境地址
- [ ] QQ OAuth 配置（如需启用QQ登录）
  - `QQ_APP_ID` 和 `QQ_APP_KEY` 已配置
  - QQ互联回调URL已更新为生产环境地址

---

## 二、数据库准备

### ✅ MongoDB Atlas 配置

- [ ] 已创建生产环境数据库集群
- [ ] 数据库用户已创建，权限配置正确
- [ ] IP 白名单已配置
  - 添加 `0.0.0.0/0` (允许所有IP) 或
  - 添加 Vercel 的 IP 范围
- [ ] 连接字符串已测试（可以成功连接）

### ✅ 数据初始化

- [ ] 数据库索引已创建（运行 `pnpm run db:indexes`）
- [ ] 知识点数据已导入（运行 `pnpm run seed:all`）
- [ ] 演示账号已创建（可选）
  - `demo_student` / Demo2025
  - `demo_advanced` / Demo2025
  - `demo_new` / Demo2025

---

## 三、代码质量检查

### ✅ 前端代码

- [ ] 运行 `pnpm run lint` 无报错
- [ ] 所有 `console.log` 已移除或条件化（只在开发环境显示）
- [ ] 所有 `alert()` 和 `confirm()` 已替换为 Element Plus 组件
- [ ] 所有环境变量使用 `import.meta.env.VITE_` 前缀
- [ ] 构建成功（`pnpm run build`）
- [ ] 构建产物大小合理（dist 文件夹 < 5MB）

### ✅ 后端代码

- [ ] 运行 `pnpm run lint` 无报错
- [ ] 所有敏感信息（密码、token）不在日志中输出
- [ ] 错误处理完善（所有 API 都有 try-catch）
- [ ] 限流中间件已启用
- [ ] CORS 配置正确

---

## 四、功能测试

### ✅ 核心功能

- [ ] **用户认证**
  - [ ] 用户注册正常
  - [ ] 邮箱/密码登录正常
  - [ ] JWT Token 生成和验证正常
  - [ ] 登录状态持久化（刷新页面不丢失）
  - [ ] 退出登录功能正常

- [ ] **第三方登录（如已配置）**
  - [ ] GitHub 登录流程正常
  - [ ] QQ 登录流程正常
  - [ ] OAuth 回调正确重定向

- [ ] **知识库**
  - [ ] 知识点列表加载正常
  - [ ] 知识图谱渲染正常
  - [ ] 知识点详情显示正常
  - [ ] Markdown 和代码高亮正常
  - [ ] 数学公式渲染正常

- [ ] **学习功能**
  - [ ] 知识点学习计时正常
  - [ ] 学习进度保存正常
  - [ ] 知识点解锁机制正确
  - [ ] 前置知识点检查正确

- [ ] **AI 助教**
  - [ ] AI 对话功能正常
  - [ ] 多轮对话上下文保持
  - [ ] AI 响应流式显示正常
  - [ ] AI 降级机制工作（主模型失败后切换备用）
  - [ ] 代码解释功能正常

- [ ] **测验系统**
  - [ ] 测验题目加载正常
  - [ ] 答题和提交正常
  - [ ] 测验结果计算正确
  - [ ] 错题自动收录

- [ ] **错题本**
  - [ ] 错题列表显示正常
  - [ ] 错题筛选功能正常
  - [ ] AI 深度解析生成正常
  - [ ] 标记为已掌握功能正常

- [ ] **成就系统**
  - [ ] 成就列表显示正常
  - [ ] 成就解锁检测正常
  - [ ] 积分计算正确
  - [ ] 成就通知提示正常

- [ ] **数据统计**
  - [ ] 学习时长统计正确
  - [ ] 学习热力图显示正常
  - [ ] 知识点掌握率计算正确
  - [ ] 学习报告生成正常

### ✅ 边界情况测试

- [ ] 未登录状态访问受保护页面（正确跳转登录页）
- [ ] Token 过期后的处理（自动跳转登录页）
- [ ] 网络断开时的错误提示
- [ ] 空数据状态的展示（EmptyState 组件）
- [ ] 加载状态的展示（LoadingSpinner）
- [ ] 超长文本的显示处理
- [ ] 特殊字符输入的处理

---

## 五、性能测试

### ✅ 前端性能

- [ ] 首屏加载时间 < 3秒（4G网络）
- [ ] 路由切换流畅（无明显卡顿）
- [ ] 知识图谱渲染流畅（100+ 节点）
- [ ] 滚动流畅（长列表无卡顿）
- [ ] Chrome Lighthouse 分数
  - [ ] Performance > 80
  - [ ] Accessibility > 90
  - [ ] Best Practices > 80
  - [ ] SEO > 70

### ✅ 后端性能

- [ ] API 响应时间 < 500ms（90%请求）
- [ ] AI 接口响应 < 5秒
- [ ] 数据库查询优化（已添加索引）
- [ ] 并发测试（50用户同时访问无崩溃）

---

## 六、兼容性测试

### ✅ 浏览器兼容性

- [ ] Chrome (最新版) ✓
- [ ] Firefox (最新版) ✓
- [ ] Safari (最新版) ✓
- [ ] Edge (最新版) ✓

### ✅ 设备兼容性

- [ ] 桌面端 (1920x1080) ✓
- [ ] 笔记本 (1366x768) ✓
- [ ] 平板 (768x1024) ✓
- [ ] 手机 (375x667) ✓

### ✅ 响应式设计

- [ ] 移动端导航菜单正常
- [ ] 移动端知识图谱可操作
- [ ] 移动端表单输入流畅
- [ ] 横竖屏切换正常

---

## 七、安全性检查

### ✅ 认证和授权

- [ ] 密码加密存储（bcrypt）
- [ ] JWT Token 设置合理过期时间（7天）
- [ ] 所有受保护的 API 都验证 Token
- [ ] 用户只能访问自己的数据

### ✅ 数据安全

- [ ] SQL/NoSQL 注入防护（Mongoose 自带）
- [ ] XSS 攻击防护（用户输入转义）
- [ ] CSRF 防护（Token 验证）
- [ ] 敏感信息不在客户端暴露

### ✅ API 安全

- [ ] 限流保护已启用
  - 全局限流：100 请求/分钟
  - 认证接口：5 请求/分钟
  - AI 接口：20 请求/分钟
- [ ] CORS 配置正确（只允许指定域名）
- [ ] HTTPS 已启用（Vercel 自动提供）

---

## 八、文档完善度

### ✅ 必要文档

- [ ] README.md 包含完整的项目介绍
- [ ] 部署文档 (DEPLOYMENT_GUIDE.md) 详细且可操作
- [ ] 用户手册 (USER_MANUAL.md) 清晰易懂
- [ ] API 文档 (API_REFERENCE.md) 完整准确
- [ ] 环境变量示例文件 (env.example) 注释清晰

### ✅ 可选文档

- [ ] 架构设计文档
- [ ] 贡献指南
- [ ] 更新日志 (CHANGELOG.md)
- [ ] FAQ 常见问题

---

## 九、监控和日志

### ✅ 日志配置

- [ ] 生产环境日志级别设置为 `info` 或 `warn`
- [ ] 敏感信息（密码、Token）不在日志中输出
- [ ] 错误日志包含足够的上下文信息

### ✅ 监控配置

- [ ] Vercel Analytics 已启用
- [ ] 错误追踪工具已配置（Sentry 等，可选）
- [ ] 性能监控已配置（可选）

---

## 十、备份和回滚

### ✅ 数据备份

- [ ] MongoDB 定期备份策略已设置
- [ ] 重要数据本地备份一份

### ✅ 回滚方案

- [ ] Git 代码已推送到远程仓库
- [ ] Vercel 保留了之前的部署版本（可一键回滚）
- [ ] 数据库有备份（可恢复到旧版本）

---

## 十一、用户体验

### ✅ 视觉效果

- [ ] 所有页面样式统一
- [ ] 亮色/暗色主题切换正常
- [ ] 动画效果流畅自然
- [ ] 图标和图片清晰（高分辨率屏幕）

### ✅ 交互反馈

- [ ] 所有按钮点击有反馈（loading、禁用状态等）
- [ ] 表单提交有 loading 提示
- [ ] 操作成功/失败有明确提示
- [ ] 空状态有引导性提示

### ✅ 错误处理

- [ ] 网络错误有友好提示
- [ ] 404 页面有导航提示
- [ ] 服务器错误有重试提示
- [ ] 表单验证错误提示清晰

---

## 十二、SEO 优化（可选）

- [ ] 页面 Title 和 Description 已设置
- [ ] Open Graph 标签已配置（社交分享优化）
- [ ] 网站图标 (favicon) 已设置
- [ ] robots.txt 已配置
- [ ] sitemap.xml 已生成

---

## 十三、法律和合规

- [ ] 隐私政策已添加（如收集用户数据）
- [ ] 服务条款已添加
- [ ] Cookie 使用说明（如使用 Cookie）
- [ ] 第三方服务授权说明（AI 服务、OAuth 等）

---

## 十四、最终验证

### ✅ 冒烟测试（Smoke Test）

在生产环境完成以下完整流程：

1. [ ] 访问首页 → 正常加载
2. [ ] 注册新账号 → 成功
3. [ ] 登录 → 成功，跳转到主页
4. [ ] 查看知识图谱 → 正常显示
5. [ ] 选择一个知识点学习 → 内容正常显示
6. [ ] 与 AI 助教对话 → 成功获得回复
7. [ ] 完成测验 → 提交成功，查看结果
8. [ ] 查看错题本 → 错题正确显示
9. [ ] 查看个人档案 → 数据正常显示
10. [ ] 查看成就列表 → 成就正常解锁
11. [ ] 退出登录 → 成功，跳转到登录页
12. [ ] 重新登录 → 数据保留，状态正常

### ✅ 压力测试（可选）

- [ ] 使用工具（如 Artillery）进行并发测试
- [ ] 50 用户同时访问，服务正常
- [ ] 数据库连接池未耗尽
- [ ] 内存使用在合理范围

---

## ✨ 上线确认

**所有高优先级项目已完成，可以上线！**

- [ ] 我已完成所有必要检查项
- [ ] 我已准备好演示账号和测试数据
- [ ] 我已通知相关人员（如有）
- [ ] 我知道如何快速回滚（如遇问题）

**上线时间**：________年____月____日 ____:____

**负责人签名**：________________

---

## 📞 遇到问题？

如果在检查过程中遇到问题：

1. 查看 [部署文档](./DEPLOYMENT_GUIDE.md) 常见问题章节
2. 检查 Vercel 日志和浏览器控制台
3. 查看 [GitHub Issues](https://github.com/your-repo/issues)
4. 联系技术支持

---

**祝上线顺利！🎉**

*最后更新：2025年1月16日*

