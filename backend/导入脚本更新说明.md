# 导入脚本更新说明

> 📅 更新日期：2024年10月  
> 🎯 目标：适配新的24个知识点映射关系

## 📋 更新概览

根据 `映射关系审阅.md` 的最新优化方案，导入脚本已更新以支持新的知识点体系：

### ✅ 完成的更新

1. **backend/README-导入数据.md** - 完全重写
   - 添加24个知识点的完整列表
   - 更新推荐导入方式（TypeScript脚本）
   - 添加详细的故障排查指南
   - 更新数据结构说明

2. **backend/import-data-local.cjs** - 重大更新
   - 更新数据Schema以匹配新模型
   - 添加24个知识点ID常量
   - 改进错误处理和日志输出
   - 支持从TypeScript编译结果导入
   - 添加数据过滤，确保只导入配置的24个知识点

3. **import-data-local.cjs** (根目录) - 标记为弃用
   - 重定向到backend目录的新脚本
   - 提供清晰的迁移指引

4. **backend/import-knowledge-points.cjs** - 已删除 ❌
   - 功能与 `import-data-local.cjs` 重复
   - 统一使用 `import-data-local.cjs` 作为唯一的CommonJS导入脚本
   - `npm run import` 命令现在指向 `import-data-local.cjs`

## 🎯 新知识点体系（24个）

### 数据库优化结果
- ✅ 删除了12个重复/无用知识点
- ✅ 保留24个有笔记内容的核心知识点
- ✅ 所有知识点ID与配置文件完全匹配

### 知识点ID列表

```javascript
const KNOWLEDGE_POINT_IDS = [
    // 第一学年（5个）
    'cs101',          // 编程导论 (C语言) - 11个笔记
    'math101',        // 微积分 I - 11个笔记
    'cs102-discrete', // 离散数学 - 9个笔记
    'cs100',          // 计算机导论 - 8个笔记
    'cs103',          // 数据结构 - 9个笔记
    
    // 第二学年（8个）
    'math201',        // 线性代数 - 10个笔记
    'cs104',          // 高级编程 - 17个笔记 (Python + OOP)
    'math102',        // 微积分 II - 6个笔记
    'cs201',          // 计算机组成原理 - 9个笔记
    'cs202',          // 面向对象编程 - 22个笔记 (C++ + Java + JavaWeb)
    'cs203',          // 软件工程 - 10个笔记
    'cs204',          // 算法设计与分析 - 12个笔记
    'cs205',          // 操作系统 - 10个笔记
    
    // 第三学年（5个）
    'cs206-pl',       // 编程语言原理 - 12个笔记
    'cs206-db',       // 数据库系统 - 11个笔记
    'cs301',          // 计算机网络 - 11个笔记
    'ai1',            // 人工智能导论 - 8个笔记
    'ai2',            // 深度学习 - 17个笔记 (深度学习 + 机器学习)
    
    // 第四学年（6个）
    'cs402',          // 分布式系统 - 6个笔记
    'sec1',           // 网络安全 - 3个笔记
    'cs499',          // 毕业设计 - 5个笔记
    'math203',        // 概率论与数理统计 - 10个笔记
    'phys101',        // 大学物理 - 12个笔记
    'eng101'          // 大学英语 - 11个笔记
];

// 总计：24个知识点，250个笔记文件
```

## 🚀 推荐使用方式

### 方式1：一键导入（最推荐）✨

```bash
cd backend
npm run seed:all
```

**这个命令会自动完成：**
- ✅ 清空旧数据
- ✅ 导入24个知识点基础信息
- ✅ 填充250个笔记文件内容
- ✅ 验证配置文件映射

**预计时间：** 1-2分钟

### 方式2：分步导入

```bash
cd backend

# 步骤1: 导入知识点基础信息
npm run seed

# 步骤2: 填充笔记内容
npm run fill:content
```

### 方式3：按学年导入

```bash
cd backend

npm run seed:year1  # 第一学年 5个知识点
npm run seed:year2  # 第二学年 8个知识点
npm run seed:year3  # 第三学年 5个知识点
npm run seed:year4  # 第四学年 6个知识点
```

### 方式4：CommonJS脚本（向后兼容）

```bash
cd backend
npm run import:local  # 导入到本地MongoDB
```

**注意：** 此方式需要 JSON 数据文件，推荐使用 TypeScript 方式

## 📊 数据模型更新

### 新增字段

```typescript
{
    id: string;              // 唯一标识符（新格式：cs101, math101等）
    order: number;           // 学习顺序
    title: string;           // 标题
    description: string;     // 详细描述
    subject: string;         // 学科分类
    category: string;        // 类别标签
    difficulty: number;      // 难度 (1-5)
    prerequisites: string[]; // 前置知识点ID
    learningPath: string;    // 学习路径（学年/学期）
    estimatedHours: number;  // 预估学时
    contentSnippet: string;  // 内容简介
    resources: Resource[];   // 学习资源
    tags: string[];          // 标签
    subtopics: SubTopic[];   // 子主题
    status: string;          // 学习状态
    graphPosition: {x, y};   // 知识图谱位置
    contentFiles: ContentFile[]; // 笔记文件（填充后）
}
```

### 移除的字段

- `content`: 已替换为 `contentFiles` 数组
- `quiz`: 测验功能（可能在未来版本添加）

## 🔄 迁移指南

### 如果你之前使用旧脚本：

1. **停止使用** 根目录的 `import-data-local.cjs`
2. **切换到** `backend` 目录
3. **运行** `npm run seed:all`
4. **验证** 数据导入成功（应该看到24个知识点）

### 如果遇到问题：

1. **清空数据库**
   ```bash
   cd backend
   npm run seed:all  # 会自动清空旧数据
   ```

2. **检查环境变量**
   - 确保 `backend/.env` 文件存在
   - 确保 `MONGODB_URI` 或 `MONGO_URI` 已配置

3. **重新安装依赖**
   ```bash
   cd backend
   npm install
   ```

## 📁 文件映射配置

所有笔记文件映射在 `backend/src/config/content-files-config.ts` 中配置：

```typescript
export const contentFilesConfig: KnowledgePointContentConfig[] = [
    {
        knowledgePointId: 'cs101',
        files: [
            { path: 'public/笔记/C语言编程导论/...', title: '...' },
            // ... 11个文件
        ]
    },
    // ... 24个知识点配置
];
```

## ✅ 验证导入结果

### 1. 检查数据库

```javascript
// 连接到MongoDB后
db.knowledgepoints.countDocuments()  // 应该返回 24
db.knowledgepoints.find().toArray()  // 查看所有知识点
```

### 2. 检查知识点ID

所有导入的知识点应该使用新ID格式：
- ✅ `cs101`, `math101`, `cs102-discrete` ...
- ❌ ~~`cs-y1-s1-c1`, `cs-y1-s1-c2`~~ (旧格式)

### 3. 检查笔记内容

```javascript
// 查询某个知识点的笔记内容
db.knowledgepoints.findOne({id: 'cs101'}).contentFiles.length
// 应该返回 11 (C语言有11个笔记文件)
```

## 🎯 下一步

导入成功后：

1. **启动后端服务**
   ```bash
   cd backend
   npm run dev
   ```

2. **测试API**
   ```bash
   curl http://localhost:5001/api/knowledge-points
   ```

3. **启动前端**
   ```bash
   npm run dev
   ```

4. **开始学习！** 🚀

## 📞 支持

如有问题，请查看：
- `backend/README-导入数据.md` - 详细导入指南
- `映射关系审阅.md` - 知识点映射说明
- `KNOWLEDGE_POINTS_GUIDE.md` - 知识点配置指南

---

**🎉 恭喜！知识库系统已完成升级，现在包含24个精心设计的核心知识点，涵盖250个高质量笔记文件！**

