# 🚀 题库管理快速开始指南

## 📋 目录
1. [快速开始 - 批量导入现有Python题库](#1-快速开始---批量导入现有python题库)
2. [快速填充示例题库](#2-快速填充示例题库)
3. [创建自己的题库](#3-创建自己的题库)
4. [从 JSON 文件导入](#4-从-json-文件导入)
5. [查看和测试题库](#5-查看和测试题库)
6. [常用命令](#6-常用命令)

---

## 1. 快速开始 - 批量导入现有Python题库

**最简单的方式：一键导入所有Python题库！**

我们已经为你准备好了完整的Python题库（6个章节，共33个知识点，165道题）：

```bash
cd backend

# 🚀 一键导入所有Python题库
pnpm quiz:import:python
```

**包含的题库：**
- ✅ Python编程 - (一)基础语法（5个知识点）
- ✅ Python编程 - (二)函数与模块（6个知识点）
- ✅ Python编程 - (三)面向对象编程（6个知识点）
- ✅ Python编程 - (四)文件操作与异常处理（6个知识点）
- ✅ Python编程 - (五)常用库和应用（5个知识点）
- ✅ Python编程 - (六至十一)综合进阶（5个知识点）

**也可以使用脚本：**
```bash
# Windows
.\import-python-quizzes.ps1

# Linux/Mac
./import-python-quizzes.sh
```

---

## 2. 快速填充示例题库

最快的方式：直接运行预设的示例题库！

```bash
cd backend

# 填充示例题库数据（包含数据结构、编程基础、数据库等示例题）
pnpm quiz:seed

# 或者使用 npm
npm run quiz:seed
```

**预期输出：**
```
🚀 开始填充题库数据...
✅ 已连接到 MongoDB
✓ ds101: 已添加 5 道题
✓ ds102: 已添加 5 道题
✓ ds103: 已添加 5 道题
✓ prog101: 已添加 3 道题
✓ db101: 已添加 3 道题

📊 题库填充完成！
   ✅ 成功: 5
   ⚠️  未找到: 0
   ❌ 失败: 0

📚 当前共有 5 个知识点包含测验题：
   - ds101: 算法复杂度分析 (5 题)
   - ds102: 线性数据结构 (5 题)
   - ds103: 链表 (5 题)
   - prog101: 编程基础 (3 题)
   - db101: SQL基础 (3 题)
```

---

## 3. 创建自己的题库

### 方式 A: 直接在代码中编写

编辑 `backend/src/seed-quiz-data.ts`：

```typescript
// 1. 创建你的题库数组
const myCustomQuizzes: QuizData[] = [
  {
    pointId: 'your-point-id',  // 替换为你的知识点ID
    quiz: [
      {
        question: '你的问题？',
        type: 'single',  // 或 'multiple', 'boolean'
        options: ['选项A', '选项B', '选项C', '选项D'],
        correctAnswer: 0,  // 正确答案的索引
        explanation: '答案解析说明'
      },
      // 添加更多题目...
    ]
  },
  // 添加更多知识点的题库...
];

// 2. 在文件末尾的 allQuizData 中添加你的题库
const allQuizData: QuizData[] = [
  ...dataStructureQuizzes,
  ...programmingBasicsQuizzes,
  ...databaseQuizzes,
  ...myCustomQuizzes,  // ← 添加这一行
];
```

然后运行：
```bash
pnpm quiz:seed
```

### 方式 B: 使用 JSON 文件（推荐）

更简洁的方式！

**步骤 1: 创建 JSON 文件**

在对应的学科文件夹中创建题库文件，例如 `backend/quiz-templates/python/my-quiz.json`：

```json
[
  {
    "pointId": "ds101",
    "pointTitle": "算法复杂度分析",
    "quiz": [
      {
        "question": "时间复杂度 O(n²) 表示什么？",
        "type": "single",
        "options": [
          "算法执行时间与输入规模 n 的平方成正比",
          "算法需要 n² 个存储单元",
          "算法最多执行 n² 次",
          "算法的空间复杂度"
        ],
        "correctAnswer": 0,
        "explanation": "O(n²) 表示算法的时间复杂度随输入规模 n 的平方增长，常见于嵌套循环。"
      }
    ]
  }
]
```

**步骤 2: 导入到数据库**

```bash
cd backend

# 导入单个文件
pnpm quiz:import quiz-templates/python/my-quiz.json

# 或批量导入所有Python题库
pnpm quiz:import:python
```

---

## 4. 从 JSON 文件导入

### JSON 文件格式

支持两种格式：

#### 格式 1: 纯数组（推荐）
```json
[
  {
    "pointId": "ds101",
    "quiz": [...]
  }
]
```

#### 格式 2: 带分类的对象
```json
{
  "你的题库_数据结构": [
    {
      "pointId": "ds101",
      "quiz": [...]
    }
  ],
  "你的题库_编程基础": [...]
}
```

### 导入命令

```bash
# 基本用法
pnpm quiz:import <JSON文件路径>

# 示例
pnpm quiz:import quiz-templates/python/my-quiz.json
pnpm quiz:import quiz-templates/java/java-basics.json

# 批量导入（推荐）
pnpm quiz:import:python  # 导入所有Python题库
```

### 目录结构

```
backend/quiz-templates/
├── python/          # Python题库
│   ├── Python编程题库 - (一)基础语法.json
│   ├── Python编程题库 - (二)函数与模块.json
│   └── ...
├── java/           # Java题库
├── database/       # 数据库题库
├── algorithm/      # 算法题库
└── network/        # 网络题库
```

---

## 5. 查看和测试题库

### 方法 1: 使用 API

```bash
# 获取某个知识点的题目（不含答案）
curl http://localhost:5001/api/quiz/ds101

# 提交答案并获取结果
curl -X POST http://localhost:5001/api/quiz/submit \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "pointId": "ds101",
    "answers": [0, [0,1,2], 0, 1, 1]
  }'
```

### 方法 2: 在前端界面测试

1. 登录系统
2. 进入知识库
3. 点击任意知识点
4. 点击"开始测验"按钮
5. 完成答题并查看结果

### 方法 3: 使用 MongoDB Compass

1. 打开 MongoDB Compass
2. 连接到你的数据库
3. 进入 `knowledgepoints` 集合
4. 搜索 `quiz` 字段不为空的文档
5. 查看题目数据

---

## 6. 常用命令

```bash
# 进入后端目录
cd backend

# ========== 题库管理 ==========

# 批量导入Python题库（推荐）
pnpm quiz:import:python

# 填充预设的示例题库
pnpm quiz:seed

# 从 JSON 文件导入单个题库
pnpm quiz:import <json文件路径>
# 示例：pnpm quiz:import quiz-templates/python/Python编程题库 - (一)基础语法.json

# 清空所有题库（⚠️ 谨慎使用！）
pnpm quiz:clear

# ========== 知识点管理 ==========

# 填充所有知识点数据
pnpm seed:all

# 填充知识点内容
pnpm fill:content

# ========== 开发调试 ==========

# 启动开发服务器
pnpm dev

# 查看数据库索引
pnpm db:indexes
```

---

## 💡 实用技巧

### 技巧 1: 批量创建题库

使用 Excel/Google Sheets 编辑题目，然后转换为 JSON：

1. 在 Excel 中按以下列整理数据：
   - 列 A: pointId
   - 列 B: question
   - 列 C: type
   - 列 D-G: options (4 列)
   - 列 H: correctAnswer
   - 列 I: explanation

2. 使用在线工具将 Excel 转换为 JSON
3. 调整 JSON 格式为标准格式
4. 运行导入命令

### 技巧 2: 验证题库质量

在导入前检查：
- [ ] 所有问题表述清晰
- [ ] 选项长度相近
- [ ] 正确答案索引正确（从 0 开始）
- [ ] 多选题的 correctAnswer 是数组
- [ ] 所有题目都有解析说明
- [ ] type 字段只能是 single/multiple/boolean

### 技巧 3: 团队协作

使用 Git 管理题库文件：

```bash
# 创建题库分支
git checkout -b feature/quiz-database

# 添加题库文件
git add backend/quiz-templates/my-quiz.json

# 提交
git commit -m "添加数据库系统题库 (20题)"

# 推送
git push origin feature/quiz-database
```

### 技巧 4: 增量更新

只更新部分知识点的题库：

```json
[
  {
    "pointId": "ds101",
    "quiz": [
      // 只包含你要更新的知识点
    ]
  }
]
```

运行导入后，只有指定的知识点会被更新，其他不受影响。

---

## 📐 LaTeX 公式支持

题目、选项和解析中都支持 **LaTeX 数学公式**，使用 KaTeX 渲染！

### 基本用法

**行内公式**：使用单个 `$` 包裹
```json
{
  "question": "函数 $f(x) = x^2$ 的导数是 $f'(x) = 2x$",
  "explanation": "根据幂函数求导法则 $(x^n)' = nx^{n-1}$"
}
```

**块级公式**：使用双 `$$` 包裹（使用 `\n` 换行）
```json
{
  "explanation": "牛顿第二定律：\\n\\n$$\\nF = ma\\n$$\\n\\n其中 $F$ 是合力"
}
```

### 常用符号快速参考

| 类型 | LaTeX 代码 | 效果 |
|------|-----------|------|
| 分数 | `$\frac{a}{b}$` | 分数形式 |
| 根号 | `$\sqrt{x}$` | 平方根 |
| 上标 | `$x^2$` | x 的平方 |
| 下标 | `$x_i$` | x 下标 i |
| 求和 | `$\sum_{i=1}^{n}$` | 求和符号 |
| 积分 | `$\int_{a}^{b} f(x) \, dx$` | 积分符号 |
| 极限 | `$\lim_{x \to \infty}$` | 极限符号 |

### ⚠️ JSON 中的注意事项

1. **反斜杠必须转义**：`\` 要写成 `\\`
   ```json
   正确: "$\\frac{1}{2}$"
   错误: "$\frac{1}{2}$"
   ```

2. **换行使用 \n**：
   ```json
   "explanation": "解析内容\\n\\n$$\\n公式\\n$$\\n\\n继续说明"
   ```

3. **必须使用 $ 或 $$ 格式**，禁止使用 `\( \)` 或 `\[ \]`

### 示例：带公式的题目

```json
{
  "question": "定积分 $\\int_0^1 x^2 \\, dx$ 的值是多少？",
  "type": "single",
  "options": [
    "$\\frac{1}{3}$",
    "$\\frac{1}{2}$",
    "$1$",
    "$\\frac{2}{3}$"
  ],
  "correctAnswer": 0,
  "explanation": "使用牛顿-莱布尼茨公式：$\\int_0^1 x^2 \\, dx = \\left[\\frac{x^3}{3}\\right]_0^1 = \\frac{1}{3}$"
}
```

更多示例请查看 `quiz-template.json` 中的 `示例_LaTeX公式题库` 部分。

---

## 🎯 题目编写最佳实践

### ✅ 好的题目示例

```json
{
  "question": "在 Python 中，以下哪个数据结构是有序且可变的？",
  "type": "single",
  "options": [
    "列表 (list)",
    "元组 (tuple)",
    "集合 (set)",
    "字典 (dict)"
  ],
  "correctAnswer": 0,
  "explanation": "列表是有序且可变的数据结构。元组有序但不可变，集合和字典都是无序的（Python 3.7+ 字典保持插入顺序，但这是实现细节）。"
}
```

**优点：**
- ✅ 问题明确，目标清晰
- ✅ 选项格式统一
- ✅ 解析详细，有扩展知识
- ✅ 考察实用知识点

### ❌ 不好的题目示例

```json
{
  "question": "list是什么",
  "type": "single",
  "options": [
    "是一种数据结构",
    "b",
    "c",
    "我不知道"
  ],
  "correctAnswer": 0,
  "explanation": "是list"
}
```

**问题：**
- ❌ 问题不完整
- ❌ 选项不规范
- ❌ 解析不清楚
- ❌ 没有实际意义

---

## 📚 示例题库模板

查看完整示例：
- `backend/src/seed-quiz-data.ts` - TypeScript 代码示例
- `backend/quiz-templates/quiz-template.json` - JSON 模板
- `backend/quiz-templates/题库模板说明.md` - 详细文档

---

## 🆘 常见问题

### Q: 导入提示"知识点不存在"？
A: 确保你的知识点 ID（pointId）在数据库中存在。先运行 `pnpm seed:all` 填充知识点数据。

### Q: 如何查看所有知识点的 ID？
A: 
```bash
# 方法1: 查看数据库
# 在 MongoDB Compass 中查看 knowledgepoints 集合

# 方法2: 查看种子文件
grep "id:" backend/src/seed-*.ts
```

### Q: 题目导入成功但前端看不到？
A: 
1. 检查前端是否正确调用 API
2. 清除浏览器缓存
3. 检查控制台是否有错误
4. 确认用户已登录

### Q: 如何修改已有题目？
A: 重新导入即可，会覆盖原有题目。

### Q: 可以为同一个知识点多次添加题目吗？
A: 每次导入会覆盖该知识点的所有题目。如果要追加题目，需要在导入数据中包含原有题目。

---

## 📞 获取帮助

- 📖 查看详细文档：`backend/quiz-templates/题库模板说明.md`
- 🔍 查看 API 实现：`backend/src/routes/quiz.ts`
- 🗄️ 查看数据模型：`backend/src/models/KnowledgePoint.ts`
- 💬 遇到问题？检查控制台日志和错误提示

---

**祝你顺利完成题库建设！🎉**

