![(五)代码优化](https://via.placeholder.com/800x200?text=Optimization)

# 编译原理 - (五)代码优化

掌握编译优化技术。

---


### 5.1 常量折叠

```python
class ConstantFolder:
    def optimize(self, node):
        """常量折叠优化"""
        if isinstance(node, Num):
            return node
        
        elif isinstance(node, BinOp):
            left = self.optimize(node.left)
            right = self.optimize(node.right)
            
            # 如果两个操作数都是常量，直接计算
            if isinstance(left, Num) and isinstance(right, Num):
                if node.op[0] == 'PLUS':
                    return Num(('NUMBER', left.value + right.value))
                elif node.op[0] == 'MINUS':
                    return Num(('NUMBER', left.value - right.value))
                elif node.op[0] == 'MUL':
                    return Num(('NUMBER', left.value * right.value))
                elif node.op[0] == 'DIV':
                    return Num(('NUMBER', left.value / right.value))
            
            return BinOp(left, node.op, right)
        
        return node
```

---

## 6. 目标代码生成