![(六)目标代码生成](https://via.placeholder.com/800x200?text=Code+Generation)

# 编译原理 - (六)目标代码生成

学习目标代码生成。

---


### 6.1 简单汇编生成

```python
class CodeGenerator:
    def __init__(self):
        self.code = []
        self.register_count = 0
    
    def new_register(self):
        """分配寄存器"""
        self.register_count += 1
        return f'R{self.register_count}'
    
    def generate(self, node):
        """生成汇编代码"""
        if isinstance(node, Num):
            reg = self.new_register()
            self.code.append(f'LOAD {reg}, #{node.value}')
            return reg
        
        elif isinstance(node, BinOp):
            left_reg = self.generate(node.left)
            right_reg = self.generate(node.right)
            result_reg = self.new_register()
            
            op_map = {
                'PLUS': 'ADD',
                'MINUS': 'SUB',
                'MUL': 'MUL',
                'DIV': 'DIV'
            }
            
            self.code.append(f'{op_map[node.op[0]]} {result_reg}, {left_reg}, {right_reg}')
            return result_reg
    
    def print_code(self):
        """打印汇编代码"""
        for line in self.code:
            print(line)

# 测试
lexer = Lexer('2 + 3')
parser = ASTParser(lexer)
tree = parser.expr()

codegen = CodeGenerator()
codegen.generate(tree)
codegen.print_code()
```

---

## 7. 正则表达式与DFA