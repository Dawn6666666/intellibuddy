![(九)统计分析实战](https://via.placeholder.com/800x200?text=Statistical+Analysis)

# 概率论与数理统计 - (九)统计分析实战

用Python进行统计分析实战。

---


### 9.1 A/B测试

**场景**：电商网站测试两种推荐算法的转化率。

```python
import numpy as np
from scipy import stats

# 数据
# 算法A：10000次展示，500次点击
n_A, x_A = 10000, 500
p_A = x_A / n_A

# 算法B：10000次展示，550次点击
n_B, x_B = 10000, 550
p_B = x_B / n_B

# 双样本比例检验
# H0: p_A = p_B
# H1: p_A ≠ p_B

# 合并比例
p_pool = (x_A + x_B) / (n_A + n_B)

# 检验统计量
z = (p_A - p_B) / np.sqrt(p_pool * (1 - p_pool) * (1/n_A + 1/n_B))

# p值
p_value = 2 * (1 - stats.norm.cdf(abs(z)))

print(f"算法A转化率: {p_A:.4f}")
print(f"算法B转化率: {p_B:.4f}")
print(f"z统计量: {z:.4f}")
print(f"p值: {p_value:.4f}")

if p_value < 0.05:
    print("结论：两种算法转化率有显著差异")
else:
    print("结论：两种算法转化率无显著差异")
```

**输出：**
```
算法A转化率: 0.0500
算法B转化率: 0.0550
z统计量: -1.6214
p值: 0.1049
结论：两种算法转化率无显著差异
```

### 9.2 方差分析（ANOVA）

**场景**：比较3种教学方法的效果。

```python
from scipy import stats

# 3组学生成绩
method_A = [85, 88, 90, 87, 86]
method_B = [78, 80, 82, 79, 81]
method_C = [92, 94, 91, 93, 95]

# 单因素方差分析
f_stat, p_value = stats.f_oneway(method_A, method_B, method_C)

print(f"F统计量: {f_stat:.4f}")
print(f"p值: {p_value:.6f}")

if p_value < 0.05:
    print("结论：不同教学方法效果有显著差异")
    
    # 事后检验（Tukey HSD）
    from statsmodels.stats.multicomp import pairwise_tukeyhsd
    
    data = method_A + method_B + method_C
    groups = ['A']*5 + ['B']*5 + ['C']*5
    
    tukey = pairwise_tukeyhsd(data, groups, alpha=0.05)
    print("\nTukey事后检验:")
    print(tukey)
```

### 9.3 卡方独立性检验

**场景**：检验性别与购买偏好是否独立。

```python
import numpy as np
from scipy.stats import chi2_contingency

# 列联表
#        产品A  产品B  产品C
# 男性     30     20     10
# 女性     10     25     35

observed = np.array([
    [30, 20, 10],
    [10, 25, 35]
])

chi2, p_value, dof, expected = chi2_contingency(observed)

print("观测频数:")
print(observed)
print("\n期望频数:")
print(expected)
print(f"\nχ²统计量: {chi2:.4f}")
print(f"自由度: {dof}")
print(f"p值: {p_value:.6f}")

if p_value < 0.05:
    print("结论：性别与购买偏好显著相关")
else:
    print("结论：性别与购买偏好独立")
```

### 9.4 时间序列分析

**场景**：销售数据预测。

```python
import numpy as np
import matplotlib.pyplot as plt
from statsmodels.tsa.holtwinters import ExponentialSmoothing

# 月度销售数据（24个月）
sales = [120, 135, 158, 171, 196, 210, 188, 165, 
         142, 125, 130, 145, 165, 180, 201, 225, 
         245, 268, 242, 215, 189, 165, 155, 170]

# 三次指数平滑（考虑趋势和季节性）
model = ExponentialSmoothing(
    sales, 
    seasonal_periods=12,  # 12个月季节周期
    trend='add',          # 加法趋势
    seasonal='add'        # 加法季节性
)
fitted = model.fit()

# 预测未来6个月
forecast = fitted.forecast(steps=6)

# 可视化
plt.figure(figsize=(12, 6))
plt.plot(sales, label='历史数据', marker='o')
plt.plot(range(24, 30), forecast, label='预测', marker='s', color='red')
plt.xlabel('月份')
plt.ylabel('销售额')
plt.title('销售预测')
plt.legend()
plt.grid()
plt.show()

print("未来6个月预测:")
for i, val in enumerate(forecast, 1):
    print(f"第{i}个月: {val:.2f}")
```

### 9.5 相关性分析

**场景**：分析多个变量之间的相关性。

```python
import numpy as np
import pandas as pd
import seaborn as sns
import matplotlib.pyplot as plt

# 生成示例数据
np.random.seed(42)
n = 100

data = pd.DataFrame({
    '学习时间': np.random.normal(5, 1.5, n),
    '睡眠时间': np.random.normal(7, 1, n),
    '运动时间': np.random.normal(1.5, 0.5, n)
})

# 生成成绩（与学习时间正相关，与其他负相关）
data['成绩'] = (
    60 + 
    data['学习时间'] * 5 + 
    data['睡眠时间'] * 2 + 
    data['运动时间'] * 1.5 + 
    np.random.normal(0, 5, n)
)

# 计算相关系数矩阵
corr_matrix = data.corr()

print("相关系数矩阵:")
print(corr_matrix)

# 可视化
plt.figure(figsize=(10, 8))
sns.heatmap(corr_matrix, annot=True, cmap='coolwarm', 
            center=0, square=True, linewidths=1)
plt.title('变量相关性热力图')
plt.tight_layout()
plt.show()

# 显著性检验
from scipy.stats import pearsonr

for col in ['学习时间', '睡眠时间', '运动时间']:
    r, p = pearsonr(data[col], data['成绩'])
    print(f"\n{col}与成绩的相关性:")
    print(f"  相关系数 r = {r:.4f}")
    print(f"  p值 = {p:.6f}")
    if p < 0.05:
        print(f"  结论：显著相关")
    else:
        print(f"  结论：不显著")
```

---

## 10. 常用统计检验速查