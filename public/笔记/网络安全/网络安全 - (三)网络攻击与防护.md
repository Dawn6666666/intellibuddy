# ç½‘ç»œå®‰å…¨ - (ä¸‰)ç½‘ç»œæ”»å‡»ä¸é˜²æŠ¤

ç†è§£ç½‘ç»œæ”»é˜²æŠ€æœ¯ã€‚

---

## 3. ç½‘ç»œæ”»å‡»ä¸é˜²æŠ¤

### 3.1 DDoSé˜²æŠ¤

```python
import time
import threading
from collections import defaultdict, deque

class DDoSProtection:
    def __init__(self):
        # è¯·æ±‚è®¡æ•°å™¨
        self.request_counts = defaultdict(deque)
        self.blocked_ips = set()
        
        # é…ç½®å‚æ•°
        self.rate_limit = 100  # æ¯åˆ†é’Ÿæœ€å¤§è¯·æ±‚æ•°
        self.time_window = 60  # æ—¶é—´çª—å£ï¼ˆç§’ï¼‰
        self.block_duration = 300  # å°ç¦æ—¶é•¿ï¼ˆç§’ï¼‰
        
        # åœ°ç†ä½ç½®å¼‚å¸¸æ£€æµ‹
        self.geo_requests = defaultdict(lambda: defaultdict(int))
        
        # å¯åŠ¨æ¸…ç†çº¿ç¨‹
        self.cleanup_thread = threading.Thread(target=self._cleanup_expired, daemon=True)
        self.cleanup_thread.start()
    
    def is_request_allowed(self, ip_address, user_agent=None, geo_country=None):
        """æ£€æŸ¥è¯·æ±‚æ˜¯å¦è¢«å…è®¸"""
        current_time = time.time()
        
        # æ£€æŸ¥IPæ˜¯å¦è¢«å°ç¦
        if ip_address in self.blocked_ips:
            return False, "IPå·²è¢«å°ç¦"
        
        # é€Ÿç‡é™åˆ¶æ£€æŸ¥
        if not self._check_rate_limit(ip_address, current_time):
            self.blocked_ips.add(ip_address)
            # è®¾ç½®è§£å°å®šæ—¶å™¨
            threading.Timer(self.block_duration, 
                          lambda: self.blocked_ips.discard(ip_address)).start()
            return False, "è¯·æ±‚é¢‘ç‡è¿‡é«˜ï¼ŒIPå·²è¢«å°ç¦"
        
        # User-Agentæ£€æŸ¥
        if user_agent and self._is_suspicious_user_agent(user_agent):
            return False, "å¯ç–‘çš„User-Agent"
        
        # åœ°ç†ä½ç½®å¼‚å¸¸æ£€æŸ¥
        if geo_country and self._is_geo_anomaly(ip_address, geo_country):
            return False, "åœ°ç†ä½ç½®å¼‚å¸¸"
        
        return True, "è¯·æ±‚å…è®¸"
    
    def _check_rate_limit(self, ip_address, current_time):
        """æ£€æŸ¥é€Ÿç‡é™åˆ¶"""
        requests = self.request_counts[ip_address]
        
        # ç§»é™¤è¿‡æœŸè¯·æ±‚
        while requests and current_time - requests[0] > self.time_window:
            requests.popleft()
        
        # æ·»åŠ å½“å‰è¯·æ±‚
        requests.append(current_time)
        
        # æ£€æŸ¥æ˜¯å¦è¶…è¿‡é™åˆ¶
        return len(requests) <= self.rate_limit
    
    def _is_suspicious_user_agent(self, user_agent):
        """æ£€æŸ¥å¯ç–‘çš„User-Agent"""
        suspicious_patterns = [
            'bot', 'crawler', 'spider', 'scraper',
            'python-requests', 'curl', 'wget'
        ]
        
        user_agent_lower = user_agent.lower()
        return any(pattern in user_agent_lower for pattern in suspicious_patterns)
    
    def _is_geo_anomaly(self, ip_address, country):
        """æ£€æŸ¥åœ°ç†ä½ç½®å¼‚å¸¸"""
        # è®°å½•IPçš„åœ°ç†ä½ç½®
        self.geo_requests[ip_address][country] += 1
        
        # å¦‚æœåŒä¸€IPæ¥è‡ªå¤šä¸ªå›½å®¶ï¼Œå¯èƒ½æ˜¯ä»£ç†
        countries = list(self.geo_requests[ip_address].keys())
        if len(countries) > 3:  # è¶…è¿‡3ä¸ªå›½å®¶
            return True
        
        return False
    
    def _cleanup_expired(self):
        """æ¸…ç†è¿‡æœŸæ•°æ®"""
        while True:
            time.sleep(60)  # æ¯åˆ†é’Ÿæ¸…ç†ä¸€æ¬¡
            current_time = time.time()
            
            # æ¸…ç†è¿‡æœŸçš„è¯·æ±‚è®°å½•
            for ip in list(self.request_counts.keys()):
                requests = self.request_counts[ip]
                while requests and current_time - requests[0] > self.time_window:
                    requests.popleft()
                
                # å¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œåˆ é™¤è®°å½•
                if not requests:
                    del self.request_counts[ip]

class LoadBalancer:
    def __init__(self, servers):
        self.servers = servers
        self.current_index = 0
        self.server_health = {server: True for server in servers}
    
    def get_server(self):
        """è·å–å¯ç”¨æœåŠ¡å™¨"""
        # ç®€å•è½®è¯¢
        attempts = 0
        while attempts < len(self.servers):
            server = self.servers[self.current_index]
            self.current_index = (self.current_index + 1) % len(self.servers)
            
            if self.server_health[server]:
                return server
            
            attempts += 1
        
        return None  # æ‰€æœ‰æœåŠ¡å™¨éƒ½ä¸å¯ç”¨
    
    def mark_server_down(self, server):
        """æ ‡è®°æœåŠ¡å™¨ä¸‹çº¿"""
        self.server_health[server] = False
        print(f"ğŸš¨ æœåŠ¡å™¨ {server} æ ‡è®°ä¸ºä¸‹çº¿")
    
    def mark_server_up(self, server):
        """æ ‡è®°æœåŠ¡å™¨ä¸Šçº¿"""
        self.server_health[server] = True
        print(f"âœ… æœåŠ¡å™¨ {server} æ¢å¤ä¸Šçº¿")

# æµ‹è¯•DDoSé˜²æŠ¤
ddos_protection = DDoSProtection()
load_balancer = LoadBalancer(['server1', 'server2', 'server3'])

print("ğŸ§ª DDoSé˜²æŠ¤æµ‹è¯•:")

# æ¨¡æ‹Ÿæ­£å¸¸è¯·æ±‚
for i in range(5):
    allowed, reason = ddos_protection.is_request_allowed(
        "192.168.1.100", 
        "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"
    )
    print(f"æ­£å¸¸è¯·æ±‚ {i+1}: {allowed} - {reason}")

# æ¨¡æ‹Ÿæ”»å‡»è¯·æ±‚
print("\nğŸš¨ æ¨¡æ‹ŸDDoSæ”»å‡»:")
for i in range(105):  # è¶…è¿‡é€Ÿç‡é™åˆ¶
    allowed, reason = ddos_protection.is_request_allowed("192.168.1.200")
    if not allowed:
        print(f"æ”»å‡»è¯·æ±‚ {i+1}: {allowed} - {reason}")
        break

# æ¨¡æ‹Ÿå¯ç–‘User-Agent
allowed, reason = ddos_protection.is_request_allowed(
    "192.168.1.300", 
    "python-requests/2.25.1"
)
print(f"å¯ç–‘UA: {allowed} - {reason}")

# è´Ÿè½½å‡è¡¡æµ‹è¯•
print(f"\nâš–ï¸  è´Ÿè½½å‡è¡¡:")
for i in range(5):
    server = load_balancer.get_server()
    print(f"è¯·æ±‚ {i+1} -> {server}")
```

---

## ğŸ“š å­¦ä¹ å»ºè®®

### å®è·µé¡¹ç›®

1. **Webåº”ç”¨å®‰å…¨æ‰«æå™¨**
2. **ç½‘ç»œå…¥ä¾µæ£€æµ‹ç³»ç»Ÿ**
3. **å¯†ç ç ´è§£å·¥å…·**
4. **å®‰å…¨å®¡è®¡ç³»ç»Ÿ**

### æ¨èå·¥å…·

ğŸ› ï¸ **å®‰å…¨å·¥å…·ï¼š**
- **Nmap** - ç½‘ç»œæ‰«æ
- **Wireshark** - æµé‡åˆ†æ
- **Burp Suite** - Webå®‰å…¨æµ‹è¯•
- **Metasploit** - æ¸—é€æµ‹è¯•

### è®¤è¯è€ƒè¯•

ğŸ† **å®‰å…¨è®¤è¯ï¼š**
- **CISSP** - ä¿¡æ¯å®‰å…¨ä¸“å®¶
- **CEH** - é“å¾·é»‘å®¢
- **OSCP** - æ¸—é€æµ‹è¯•ä¸“å®¶

---

> **è®°ä½**ï¼šå®‰å…¨æ˜¯ä¸€ä¸ªæŒç»­çš„è¿‡ç¨‹ï¼Œä¸æ˜¯ä¸€æ¬¡æ€§çš„äº§å“ï¼ğŸ›¡ï¸

---

**æœ¬ç« å®Œ**
