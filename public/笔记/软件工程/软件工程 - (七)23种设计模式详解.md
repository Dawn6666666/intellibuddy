![(七)23种设计模式详解](https://via.placeholder.com/800x200?text=Design+Patterns+23)

# 软件工程 - (七)23种设计模式详解

深入学习GoF设计模式。

---


### 7.1 创建型模式（5种）

#### 抽象工厂模式

```python
from abc import ABC, abstractmethod

class GUIFactory(ABC):
    """抽象工厂"""
    @abstractmethod
    def create_button(self):
        pass
    
    @abstractmethod
    def create_textbox(self):
        pass

class WindowsFactory(GUIFactory):
    """Windows工厂"""
    def create_button(self):
        return WindowsButton()
    
    def create_textbox(self):
        return WindowsTextBox()

class MacFactory(GUIFactory):
    """Mac工厂"""
    def create_button(self):
        return MacButton()
    
    def create_textbox(self):
        return MacTextBox()

# 使用
factory = WindowsFactory()
button = factory.create_button()
textbox = factory.create_textbox()
```

#### 建造者模式

```python
class Computer:
    """产品类"""
    def __init__(self):
        self.cpu = None
        self.memory = None
        self.storage = None
    
    def __str__(self):
        return f"Computer(CPU={self.cpu}, Memory={self.memory}, Storage={self.storage})"

class ComputerBuilder:
    """建造者"""
    def __init__(self):
        self.computer = Computer()
    
    def set_cpu(self, cpu):
        self.computer.cpu = cpu
        return self
    
    def set_memory(self, memory):
        self.computer.memory = memory
        return self
    
    def set_storage(self, storage):
        self.computer.storage = storage
        return self
    
    def build(self):
        return self.computer

# 使用（链式调用）
computer = (ComputerBuilder()
    .set_cpu("Intel i7")
    .set_memory("16GB")
    .set_storage("512GB SSD")
    .build())
print(computer)
```

#### 原型模式

```python
import copy

class Prototype:
    """原型类"""
    def __init__(self):
        self.data = {}
    
    def clone(self):
        """深拷贝"""
        return copy.deepcopy(self)

# 使用
original = Prototype()
original.data = {'name': 'Alice', 'scores': [90, 85, 95]}

cloned = original.clone()
cloned.data['scores'].append(88)

print(f"原始: {original.data}")
print(f"克隆: {cloned.data}")
```

### 7.2 结构型模式（7种）

#### 适配器模式

```python
class OldPrinter:
    """旧打印机（被适配类）"""
    def print_old(self, text):
        print(f"[旧打印机] {text}")

class PrinterAdapter:
    """适配器"""
    def __init__(self, old_printer):
        self.old_printer = old_printer
    
    def print(self, text):
        """统一接口"""
        self.old_printer.print_old(text)

# 使用
old = OldPrinter()
adapter = PrinterAdapter(old)
adapter.print("Hello")  # 使用统一接口
```

#### 装饰器模式

```python
class Coffee:
    """基础组件"""
    def cost(self):
        return 10

class MilkDecorator:
    """牛奶装饰器"""
    def __init__(self, coffee):
        self._coffee = coffee
    
    def cost(self):
        return self._coffee.cost() + 3

class SugarDecorator:
    """糖装饰器"""
    def __init__(self, coffee):
        self._coffee = coffee
    
    def cost(self):
        return self._coffee.cost() + 1

# 使用
coffee = Coffee()
print(f"基础咖啡: {coffee.cost()}元")

coffee_with_milk = MilkDecorator(coffee)
print(f"加牛奶: {coffee_with_milk.cost()}元")

coffee_deluxe = SugarDecorator(MilkDecorator(coffee))
print(f"加牛奶和糖: {coffee_deluxe.cost()}元")
```

#### 代理模式

```python
class RealImage:
    """真实对象"""
    def __init__(self, filename):
        self.filename = filename
        self.load_from_disk()
    
    def load_from_disk(self):
        print(f"从磁盘加载图片: {self.filename}")
    
    def display(self):
        print(f"显示图片: {self.filename}")

class ImageProxy:
    """代理对象（延迟加载）"""
    def __init__(self, filename):
        self.filename = filename
        self._real_image = None
    
    def display(self):
        if self._real_image is None:
            self._real_image = RealImage(self.filename)
        self._real_image.display()

# 使用
image = ImageProxy("photo.jpg")  # 不加载
print("代理创建完成")
image.display()  # 第一次使用时才加载
image.display()  # 不再重复加载
```

### 7.3 行为型模式（11种）

#### 策略模式

```python
from abc import ABC, abstractmethod

class PaymentStrategy(ABC):
    """支付策略接口"""
    @abstractmethod
    def pay(self, amount):
        pass

class CreditCardPayment(PaymentStrategy):
    """信用卡支付"""
    def pay(self, amount):
        print(f"使用信用卡支付 {amount}元")

class AlipayPayment(PaymentStrategy):
    """支付宝支付"""
    def pay(self, amount):
        print(f"使用支付宝支付 {amount}元")

class ShoppingCart:
    """购物车（上下文）"""
    def __init__(self, payment_strategy):
        self.payment_strategy = payment_strategy
    
    def checkout(self, amount):
        self.payment_strategy.pay(amount)

# 使用
cart1 = ShoppingCart(CreditCardPayment())
cart1.checkout(100)

cart2 = ShoppingCart(AlipayPayment())
cart2.checkout(200)
```

#### 模板方法模式

```python
from abc import ABC, abstractmethod

class DataMiner(ABC):
    """模板类"""
    def mine(self, path):
        """模板方法"""
        data = self.open_file(path)
        data = self.extract_data(data)
        data = self.analyze_data(data)
        self.send_report(data)
    
    @abstractmethod
    def open_file(self, path):
        pass
    
    @abstractmethod
    def extract_data(self, data):
        pass
    
    def analyze_data(self, data):
        """默认实现"""
        return f"分析: {data}"
    
    def send_report(self, data):
        print(f"发送报告: {data}")

class PDFDataMiner(DataMiner):
    """PDF数据挖掘"""
    def open_file(self, path):
        return f"打开PDF: {path}"
    
    def extract_data(self, data):
        return f"提取PDF数据: {data}"

class CSVDataMiner(DataMiner):
    """CSV数据挖掘"""
    def open_file(self, path):
        return f"打开CSV: {path}"
    
    def extract_data(self, data):
        return f"提取CSV数据: {data}"

# 使用
pdf_miner = PDFDataMiner()
pdf_miner.mine("report.pdf")
```

#### 状态模式

```python
class State(ABC):
    """状态接口"""
    @abstractmethod
    def handle(self, context):
        pass

class StartState(State):
    """开始状态"""
    def handle(self, context):
        print("进入开始状态")
        context.state = RunningState()

class RunningState(State):
    """运行状态"""
    def handle(self, context):
        print("进入运行状态")
        context.state = StopState()

class StopState(State):
    """停止状态"""
    def handle(self, context):
        print("进入停止状态")

class Context:
    """上下文"""
    def __init__(self):
        self.state = StartState()
    
    def request(self):
        self.state.handle(self)

# 使用
context = Context()
context.request()  # 开始 → 运行
context.request()  # 运行 → 停止
```

---

## 8. 敏捷开发实践